<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CommsChampion Ecosystem MQTT5 Client: MQTT5 Client Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CommsChampion Ecosystem MQTT5 Client
   </div>
   <div id="projectbrief">MQTT5 Client Library.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MQTT5 Client Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#cc_mqtt5_client_overview">Overview</a></li>
<li class="level1"><a href="#cc_mqtt5_client_version">Version of the Library</a></li>
<li class="level1"><a href="#cc_mqtt5_client_header">Header</a></li>
<li class="level1"><a href="#cc_mqtt5_client_allocation">Client Allocation</a></li>
<li class="level1"><a href="#cc_mqtt5_client_callbacks">&quot;Must Have&quot; Callbacks Registration</a><ul><li class="level2"><a href="#cc_mqtt5_client_callbacks_send_data">Sending Data To Broker</a></li>
<li class="level2"><a href="#cc_mqtt5_client_callbacks_broker_disconnect">Reporting Unsolicited Broker Disconnection</a></li>
<li class="level2"><a href="#cc_mqtt5_client_callbacks_message">Reporting Received Message</a></li>
</ul>
</li>
<li class="level1"><a href="#cc_mqtt5_client_time">Time Measurement</a></li>
<li class="level1"><a href="#cc_mqtt5_client_log">Error Logging</a></li>
<li class="level1"><a href="#cc_mqtt5_client_init">Client (Re)Initialization</a></li>
<li class="level1"><a href="#cc_mqtt5_client_data">Reporting Incoming Data</a></li>
<li class="level1"><a href="#cc_mqtt5_client_concepts">Operating Concepts</a></li>
<li class="level1"><a href="#cc_mqtt5_client_response_timeout">Default Response Timeout</a></li>
<li class="level1"><a href="#cc_mqtt5_client_connect">Connecting to Broker</a><ul><li class="level2"><a href="#cc_mqtt5_client_connect_prepare">Preparing &quot;Connect&quot; Operation.</a></li>
<li class="level2"><a href="#cc_mqtt5_client_connect_response_timeout">Configuring &quot;Connect&quot; Response Timeout</a></li>
<li class="level2"><a href="#cc_mqtt5_client_connect_basic">Basic Configuration of &quot;Connect&quot; Operation</a></li>
<li class="level2"><a href="#cc_mqtt5_client_connect_will">Will Configuration</a></li>
<li class="level2"><a href="#cc_mqtt5_client_connect_extra">Extra Properties Configuration</a></li>
<li class="level2"><a href="#cc_mqtt5_client_connect_auth">Extended Authentication Handshake Configuration</a></li>
<li class="level2"><a href="#cc_mqtt5_client_connect_user_prop">Adding &quot;User Properties&quot;</a></li>
<li class="level2"><a href="#cc_mqtt5_client_connect_send">Sending Connection Request</a></li>
<li class="level2"><a href="#cc_mqtt5_client_connect_cancel">Cancel the &quot;Connect&quot; Operation.</a></li>
<li class="level2"><a href="#cc_mqtt5_client_connect_check">Check The Library Remains Connected</a></li>
</ul>
</li>
<li class="level1"><a href="#cc_mqtt5_client_disconnect">Disconnecting From Broker</a><ul><li class="level2"><a href="#cc_mqtt5_client_disconnect_prepare">Preparing &quot;Disconnect&quot; Operation.</a></li>
<li class="level2"><a href="#cc_mqtt5_client_disconnect_config">Configuration of &quot;Disconnect&quot; Operation</a></li>
<li class="level2"><a href="#cc_mqtt5_client_disconnect_user_prop">Adding &quot;User Properties&quot;</a></li>
<li class="level2"><a href="#cc_mqtt5_client_disconnect_send">Sending Disconnection Request</a></li>
<li class="level2"><a href="#cc_mqtt5_client_disconnect_cancel">Cancel the &quot;Disconnect&quot; Operation.</a></li>
</ul>
</li>
<li class="level1"><a href="#cc_mqtt5_client_subscribe">Subscribing to Receive Messages</a><ul><li class="level2"><a href="#cc_mqtt5_client_subscribe_prepare">Preparing &quot;Subscribe&quot; Operation.</a></li>
<li class="level2"><a href="#cc_mqtt5_client_subscribe_response_timeout">Configuring &quot;Subscribe&quot; Response Timeout</a></li>
<li class="level2"><a href="#cc_mqtt5_client_subscribe_topic">Topic Configuration</a></li>
<li class="level2"><a href="#cc_mqtt5_client_subscribe_extra">Extra Properties Configuration</a></li>
<li class="level2"><a href="#cc_mqtt5_client_subscribe_user_prop">Adding &quot;User Properties&quot;</a></li>
<li class="level2"><a href="#cc_mqtt5_client_subscribe_send">Sending Subscription Request</a></li>
<li class="level2"><a href="#cc_mqtt5_client_subscribe_cancel">Cancel the &quot;Subscribe&quot; Operation.</a></li>
</ul>
</li>
<li class="level1"><a href="#cc_mqtt5_client_unsubscribe">Unsubscribing from Message Reception</a><ul><li class="level2"><a href="#cc_mqtt5_client_unsubscribe_prepare">Preparing &quot;Unsubscribe&quot; Operation.</a></li>
<li class="level2"><a href="#cc_mqtt5_client_unsubscribe_response_timeout">Configuring &quot;Unsubscribe&quot; Response Timeout</a></li>
<li class="level2"><a href="#cc_mqtt5_client_unsubscribe_topic">Topic Configuration</a></li>
<li class="level2"><a href="#cc_mqtt5_client_unsubscribe_user_prop">Adding &quot;User Properties&quot;</a></li>
<li class="level2"><a href="#cc_mqtt5_client_unsubscribe_send">Sending Unsubscription Request</a></li>
<li class="level2"><a href="#cc_mqtt5_client_unsubscribe_cancel">Cancel the &quot;Unsubscribe&quot; Operation.</a></li>
</ul>
</li>
<li class="level1"><a href="#cc_mqtt5_client_publish">Publishing Messages</a><ul><li class="level2"><a href="#cc_mqtt5_client_publish_prepare">Preparing &quot;Publish&quot; Operation.</a></li>
<li class="level2"><a href="#cc_mqtt5_client_publish_response_timeout">Configuring &quot;Publish&quot; Response Timeout</a></li>
<li class="level2"><a href="#cc_mqtt5_client_publish_resend">Configuring &quot;Publish&quot; Re-Send Attempts</a></li>
<li class="level2"><a href="#cc_mqtt5_client_publish_basic">Basic Configuration of &quot;Publish&quot; Operation</a></li>
<li class="level2"><a href="#cc_mqtt5_client_publish_extra">Extra Properties Configuration</a></li>
<li class="level2"><a href="#cc_mqtt5_client_publish_user_prop">Adding &quot;User Properties&quot;</a></li>
<li class="level2"><a href="#cc_mqtt5_client_publish_send">Sending Publish Request</a></li>
<li class="level2"><a href="#cc_mqtt5_client_publish_cancel">Cancel the &quot;Publish&quot; Operation.</a></li>
<li class="level2"><a href="#cc_mqtt5_client_publish_alias">Using Topic Alias</a></li>
</ul>
</li>
<li class="level1"><a href="#cc_mqtt5_client_receive">Receiving Messages</a></li>
<li class="level1"><a href="#cc_mqtt5_client_reauth">Re-Authenticating</a><ul><li class="level2"><a href="#cc_mqtt5_client_reauth_prepare">Preparing &quot;Rauth&quot; Operation.</a></li>
<li class="level2"><a href="#cc_mqtt5_client_reauth_response_timeout">Configuring &quot;Reauth&quot; Response Timeout</a></li>
<li class="level2"><a href="#cc_mqtt5_client_reauth_auth">(Re)Authentication Handshake Configuration</a></li>
<li class="level2"><a href="#cc_mqtt5_client_reauth_send">Sending Re-Authentication Request</a></li>
<li class="level2"><a href="#cc_mqtt5_client_reauth_cancel">Cancel the &quot;Reauth&quot; Operation.</a></li>
</ul>
</li>
<li class="level1"><a href="#cc_mqtt5_client_unsolicited_disconnect">Unsolicited Broker Disconnection</a><ul><li class="level2"><a href="#cc_mqtt5_client_unsolicited_disconnect_msg">Receiving DISCONNECT message</a></li>
<li class="level2"><a href="#cc_mqtt5_client_unsolicited_disconnect_protocol_error">Detecting Protocol Error</a></li>
</ul>
</li>
<li class="level1"><a href="#cc_mqtt5_client_network_disconnect">Network Disconnection</a></li>
<li class="level1"><a href="#cc_mqtt5_client_thread_safety">Thread Safety</a></li>
<li class="level1"><a href="#cc_mqtt5_client_debug_build">Debug Build</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="cc_mqtt5_client_overview"></a>
Overview</h1>
<p>The <b>MQTT5 Client Library</b> from the <a href="https://commschamp.github.io/">CommsChampion Ecosystem</a> provides simple, asynchronous, non-blocking, and easy to use interface to operate MQTT5 client. The library doesn't make any assumption on the system it is running on, as well as on the type of I/O link being used to communicate its data to the MQTT5 capable broker.</p>
<p>It is a responsibility of the calling application to manage network connectivity as well as measure time required for the correct operation of the MQTT5 protocol.</p>
<p>The library allows the application to have a full control over the raw data for any extra analysis and/or manipulation, such as encryption.</p>
<h1><a class="anchor" id="cc_mqtt5_client_version"></a>
Version of the Library</h1>
<p>The version is of the library applicable to this documentation is defined in the <a class="el" href="common_8h.html">cc_mqtt5_client/common.h</a> file using the following defines: </p><ul>
<li><a class="el" href="group__global.html#ga60816fea14ab5afd0731cec1ddcfa92e">CC_MQTT5_CLIENT_MAJOR_VERSION</a> </li>
<li><a class="el" href="group__global.html#ga1725c46b37922b2e321f3b9b6fc58de9">CC_MQTT5_CLIENT_MINOR_VERSION</a> </li>
<li><a class="el" href="group__global.html#ga197f1268575d85f3c08c4ee3e8dd1c9a">CC_MQTT5_CLIENT_PATCH_VERSION</a></li>
</ul>
<h1><a class="anchor" id="cc_mqtt5_client_header"></a>
Header</h1>
<p>To use this <b>MQTT5 Client Library</b> use the following single include statement: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cc_mqtt5_client/client.h&quot;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="cc_mqtt5_client_allocation"></a>
Client Allocation</h1>
<p>The library supports multiple independent MQTT5 client sessions. The allocation of data structures relevant to a single client is performed using <a class="el" href="group__client.html#gaa955f88ddca4c7b695074312b5a8cbee" title="Allocate new client.">cc_mqtt5_client_alloc()</a> function. </p><div class="fragment"><div class="line"><a class="code" href="group__client.html#gaf09e56d2f3d5de2219913de76a1704a9">CC_Mqtt5ClientHandle</a> client = <a class="code" href="group__client.html#gaa955f88ddca4c7b695074312b5a8cbee">cc_mqtt5_client_alloc</a>();</div>
<div class="ttc" id="agroup__client_html_gaa955f88ddca4c7b695074312b5a8cbee"><div class="ttname"><a href="group__client.html#gaa955f88ddca4c7b695074312b5a8cbee">cc_mqtt5_client_alloc</a></div><div class="ttdeci">CC_Mqtt5ClientHandle cc_mqtt5_client_alloc()</div><div class="ttdoc">Allocate new client.</div></div>
<div class="ttc" id="agroup__client_html_gaf09e56d2f3d5de2219913de76a1704a9"><div class="ttname"><a href="group__client.html#gaf09e56d2f3d5de2219913de76a1704a9">CC_Mqtt5ClientHandle</a></div><div class="ttdeci">CC_Mqtt5Client * CC_Mqtt5ClientHandle</div><div class="ttdoc">Handle used to access client specific data structures.</div><div class="ttdef"><b>Definition:</b> common.h:192</div></div>
</div><!-- fragment --><p> All other functions are client specific, they receive the returned handle as their first parameter.</p>
<p>When work with allocated client is complete, it must be freed using <a class="el" href="group__client.html#ga0c7322dcd97fc1c40326147532c561ad" title="Free previously allocated client.">cc_mqtt5_client_free()</a> function. </p><div class="fragment"><div class="line"><a class="code" href="group__client.html#ga0c7322dcd97fc1c40326147532c561ad">cc_mqtt5_client_free</a>(client);</div>
<div class="ttc" id="agroup__client_html_ga0c7322dcd97fc1c40326147532c561ad"><div class="ttname"><a href="group__client.html#ga0c7322dcd97fc1c40326147532c561ad">cc_mqtt5_client_free</a></div><div class="ttdeci">void cc_mqtt5_client_free(CC_Mqtt5ClientHandle handle)</div><div class="ttdoc">Free previously allocated client.</div></div>
</div><!-- fragment --><p>When working with C++ it is advised to use a smart pointer with a custom deleter. </p><div class="fragment"><div class="line"><span class="keyword">struct </span>MyDeleter</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">void</span> operator()(CC_Mqtt5Client* ptr)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__client.html#ga0c7322dcd97fc1c40326147532c561ad">::cc_mqtt5_client_free</a>(ptr);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> MyClientPtr = std::unique_ptr&lt;CC_Mqtt5Client, MyDeleter&gt;;</div>
<div class="line"> </div>
<div class="line">MyClientPtr clientPtr(::<a class="code" href="group__client.html#gaa955f88ddca4c7b695074312b5a8cbee">cc_mqtt5_client_alloc</a>());</div>
<div class="line"><a class="code" href="group__client.html#gaf09e56d2f3d5de2219913de76a1704a9">CC_Mqtt5ClientHandle</a> client = clientPtr.get();</div>
</div><!-- fragment --><p><b>IMPORTANT:</b> The function <b><a class="el" href="group__client.html#ga0c7322dcd97fc1c40326147532c561ad" title="Free previously allocated client.">cc_mqtt5_client_free()</a></b> must <b>NOT</b> be called from within a callback. Use next event loop iteration.</p>
<h1><a class="anchor" id="cc_mqtt5_client_callbacks"></a>
"Must Have" Callbacks Registration</h1>
<p>In order to properly function the library requires setting several callbacks.</p>
<h2><a class="anchor" id="cc_mqtt5_client_callbacks_send_data"></a>
Sending Data To Broker</h2>
<p>To client application must assign a callback for the library to be able to send binary data out to the connected broker. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> my_send_data_cb(<span class="keywordtype">void</span>* data, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf, <span class="keywordtype">unsigned</span> bufLen)</div>
<div class="line">{</div>
<div class="line">    ... <span class="comment">/* send requested buffer to the broker */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="client_8h.html#a2b4c31e4c1b1fadf587ee2e727d595d2">cc_mqtt5_client_set_send_output_data_callback</a>(client, &amp;my_send_data_cb, data);</div>
<div class="ttc" id="aclient_8h_html_a2b4c31e4c1b1fadf587ee2e727d595d2"><div class="ttname"><a href="client_8h.html#a2b4c31e4c1b1fadf587ee2e727d595d2">cc_mqtt5_client_set_send_output_data_callback</a></div><div class="ttdeci">void cc_mqtt5_client_set_send_output_data_callback(CC_Mqtt5ClientHandle handle, CC_Mqtt5SendOutputDataCb cb, void *data)</div><div class="ttdoc">Set callback to send raw data over I/O link.</div></div>
</div><!-- fragment --><p> See also the documentation of the <a class="el" href="group__client.html#gac26155abcf6af88f3e7f3f858ce1eda2">CC_Mqtt5SendOutputDataCb</a> callback function definition.</p>
<p>In the invoked callback the application is responsible to send the provided data over the I/O link. The application can also perform extra data manipulation like encryption.</p>
<p>The reported data resides in internal data structures of the client library, which can be updated / deleted right after the callback function returns. It means the data may need to be copied into some other buffer, which will be held intact until the send over I/O link operation is complete.</p>
<h2><a class="anchor" id="cc_mqtt5_client_callbacks_broker_disconnect"></a>
Reporting Unsolicited Broker Disconnection</h2>
<p>The client application must assign a callback for the library to report discovered broker disconnection. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> my_broker_disconnected_cb(<span class="keywordtype">void</span>* data, <span class="keyword">const</span> CC_Mqtt5DisconnectInfo* info)</div>
<div class="line">{</div>
<div class="line">    ... <span class="comment">/* handle broker disconnection */</span></div>
<div class="line">    <span class="keywordflow">if</span> (info != NULL) {</div>
<div class="line">        ... <span class="comment">/* Access disconnection report details */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="client_8h.html#a69eb3593894b142f5f4b4e044e04d527">cc_mqtt5_client_set_broker_disconnect_report_callback</a>(client, &amp;my_broker_disconnected_cb, data);</div>
<div class="ttc" id="aclient_8h_html_a69eb3593894b142f5f4b4e044e04d527"><div class="ttname"><a href="client_8h.html#a69eb3593894b142f5f4b4e044e04d527">cc_mqtt5_client_set_broker_disconnect_report_callback</a></div><div class="ttdeci">void cc_mqtt5_client_set_broker_disconnect_report_callback(CC_Mqtt5ClientHandle handle, CC_Mqtt5BrokerDisconnectReportCb cb, void *data)</div><div class="ttdoc">Set callback to report unsolicited disconnection of the broker.</div></div>
</div><!-- fragment --><p> See also the documentation of the <a class="el" href="group__client.html#ga84becfb57b38d64046e33a931129ed60">CC_Mqtt5BrokerDisconnectReportCb</a> callback function definition.</p>
<p>When the broker disconnection is due to reception of the <b>DISCONNECT</b> message from the broker the "info" parameter will report a disconnection reason as well as extra information reported by the broker. If the broker disconnection is due to other reasons, the "info" parameter will be <b>NULL</b>. See also <a class="el" href="index.html#cc_mqtt5_client_unsolicited_disconnect">Unsolicited Broker Disconnection</a> for details.</p>
<h2><a class="anchor" id="cc_mqtt5_client_callbacks_message"></a>
Reporting Received Message</h2>
<p>The client application must assign a callback for the library to report messages received from the broker. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> my_message_received_cb(<span class="keywordtype">void</span>* data, <span class="keyword">const</span> <a class="code" href="structCC__Mqtt5MessageInfo.html">CC_Mqtt5MessageInfo</a>* info)</div>
<div class="line">{</div>
<div class="line">    ... <span class="comment">/* handle the received message */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="client_8h.html#ab8b2f53b91e460364c14cb340f96700c">cc_mqtt5_client_set_message_received_report_callback</a>(client, &amp;my_message_received_cb, data);</div>
<div class="ttc" id="aclient_8h_html_ab8b2f53b91e460364c14cb340f96700c"><div class="ttname"><a href="client_8h.html#ab8b2f53b91e460364c14cb340f96700c">cc_mqtt5_client_set_message_received_report_callback</a></div><div class="ttdeci">void cc_mqtt5_client_set_message_received_report_callback(CC_Mqtt5ClientHandle handle, CC_Mqtt5MessageReceivedReportCb cb, void *data)</div><div class="ttdoc">Set callback to report received message from the broker.</div></div>
<div class="ttc" id="astructCC__Mqtt5MessageInfo_html"><div class="ttname"><a href="structCC__Mqtt5MessageInfo.html">CC_Mqtt5MessageInfo</a></div><div class="ttdoc">Received message information.</div><div class="ttdef"><b>Definition:</b> common.h:417</div></div>
</div><!-- fragment --><p> See also the documentation of the <a class="el" href="group__client.html#ga4ce5ee72b2dda212cea9a448df397513">CC_Mqtt5MessageReceivedReportCb</a> callback function definition.</p>
<h1><a class="anchor" id="cc_mqtt5_client_time"></a>
Time Measurement</h1>
<p>For the correct operation of the MQTT5 client side of the protocol, the library requires an ability to measure time. This responsibility is delegated to the application.</p>
<p>The easiest (although not very efficient or very precise) method is to periodically (say every 20ms - 50ms) call the <b><a class="el" href="group__client.html#gaad35f667417f0d68eb777e53bfe02cb8" title="Notify client about requested time expiry.">cc_mqtt5_client_tick()</a></b> function reporting the amount of elapsed milliseconds: </p><div class="fragment"><div class="line"><a class="code" href="group__client.html#gaad35f667417f0d68eb777e53bfe02cb8">cc_mqtt5_client_tick</a>(client, 50U);</div>
<div class="ttc" id="agroup__client_html_gaad35f667417f0d68eb777e53bfe02cb8"><div class="ttname"><a href="group__client.html#gaad35f667417f0d68eb777e53bfe02cb8">cc_mqtt5_client_tick</a></div><div class="ttdeci">void cc_mqtt5_client_tick(CC_Mqtt5ClientHandle handle, unsigned ms)</div><div class="ttdoc">Notify client about requested time expiry.</div></div>
</div><!-- fragment --><p> The library will check if some inner timer has expired and may initiate some response via invocation one of the registered callbacks.</p>
<p>Another (recommended) method is to register a callback so the library may request the time measurement from the application, and when the requested time expires, the application is expected to call the <b><a class="el" href="group__client.html#gaad35f667417f0d68eb777e53bfe02cb8" title="Notify client about requested time expiry.">cc_mqtt5_client_tick()</a></b> function reporting amount of elapsed milliseconds. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> my_tick_program_cb(<span class="keywordtype">void</span>* data, <span class="keywordtype">unsigned</span> ms)</div>
<div class="line">{</div>
<div class="line">    ... </div>
<div class="line">    <a class="code" href="group__client.html#gaad35f667417f0d68eb777e53bfe02cb8">cc_mqtt5_client_tick</a>(client, ms); </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="client_8h.html#aa43319efb0429748e690322050aa59d4">cc_mqtt5_client_set_next_tick_program_callback</a>(client, &amp;my_tick_program_cb, data);</div>
<div class="ttc" id="aclient_8h_html_aa43319efb0429748e690322050aa59d4"><div class="ttname"><a href="client_8h.html#aa43319efb0429748e690322050aa59d4">cc_mqtt5_client_set_next_tick_program_callback</a></div><div class="ttdeci">void cc_mqtt5_client_set_next_tick_program_callback(CC_Mqtt5ClientHandle handle, CC_Mqtt5NextTickProgramCb cb, void *data)</div><div class="ttdoc">Set callback to call when time measurement is required.</div></div>
</div><!-- fragment --><p> It is allowed to invoke the <b><a class="el" href="group__client.html#gaad35f667417f0d68eb777e53bfe02cb8" title="Notify client about requested time expiry.">cc_mqtt5_client_tick()</a></b> before the actual requested timeout has expired, just make sure that the correct amount of elapsed milliseconds is reported. When the <b><a class="el" href="group__client.html#gaad35f667417f0d68eb777e53bfe02cb8" title="Notify client about requested time expiry.">cc_mqtt5_client_tick()</a></b> is invoked, it is assumed that the previously requested tick programming has been cancelled and the registered callback may be invoked again from within the <b><a class="el" href="group__client.html#gaad35f667417f0d68eb777e53bfe02cb8" title="Notify client about requested time expiry.">cc_mqtt5_client_tick()</a></b>.</p>
<p>See also the documentation of the <a class="el" href="group__client.html#ga5366e3a41330389dfa5befed0eb2a59a">CC_Mqtt5NextTickProgramCb</a> callback function definition.</p>
<p>In case of callback approach for time measurement is chosen, another callback function (in addition to the <b><a class="el" href="client_8h.html#aa43319efb0429748e690322050aa59d4" title="Set callback to call when time measurement is required.">cc_mqtt5_client_set_next_tick_program_callback()</a></b>) to allow interruption of the previously programmed tick wait must also to be registered. </p><div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> my_cancel_tick_program_cb(<span class="keywordtype">void</span>* data)</div>
<div class="line">{</div>
<div class="line">    ...</div>
<div class="line">    <span class="keywordflow">return</span> ... <span class="comment">/* return amount of elapsed milliseconds since last tick program */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="client_8h.html#a1976aea39a342a9cbb1d0eb4e7cf7ad7">cc_mqtt5_client_set_cancel_next_tick_wait_callback</a>(client, &amp;my_cancel_tick_program_cb, data);</div>
<div class="ttc" id="aclient_8h_html_a1976aea39a342a9cbb1d0eb4e7cf7ad7"><div class="ttname"><a href="client_8h.html#a1976aea39a342a9cbb1d0eb4e7cf7ad7">cc_mqtt5_client_set_cancel_next_tick_wait_callback</a></div><div class="ttdeci">void cc_mqtt5_client_set_cancel_next_tick_wait_callback(CC_Mqtt5ClientHandle handle, CC_Mqtt5CancelNextTickWaitCb cb, void *data)</div><div class="ttdoc">Set callback to terminate current time measurement.</div></div>
</div><!-- fragment --><p> See also the documentation of the <a class="el" href="group__client.html#gada43a479edab17c2994410985a80678c">CC_Mqtt5CancelNextTickWaitCb</a> callback function definition.</p>
<p>Usually the callbacks of canceling the previously programmed tick and programming a new one will be invoked as a side effect of other events, like report of the incoming data or client requesting to perform one of the available operations.</p>
<h1><a class="anchor" id="cc_mqtt5_client_log"></a>
Error Logging</h1>
<p>Sometimes the library may exhibit unexpected behaviour, like rejecting some of the parameters. To allow getting extra guidance information of what went wrong it is possible to register optional error logging callback. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> my_error_log_cb(<span class="keywordtype">void</span>* data, <span class="keyword">const</span> <span class="keywordtype">char</span>* msg)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: %s\n&quot;</span>, msg);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="client_8h.html#af2016a30a1dc1e274f2259a67545c3fe">cc_mqtt5_client_set_error_log_callback</a>(client, &amp;my_error_log_cb, data);</div>
<div class="ttc" id="aclient_8h_html_af2016a30a1dc1e274f2259a67545c3fe"><div class="ttname"><a href="client_8h.html#af2016a30a1dc1e274f2259a67545c3fe">cc_mqtt5_client_set_error_log_callback</a></div><div class="ttdeci">void cc_mqtt5_client_set_error_log_callback(CC_Mqtt5ClientHandle handle, CC_Mqtt5ErrorLogCb cb, void *data)</div><div class="ttdoc">Set callback to report error messages.</div></div>
</div><!-- fragment --><p> See also the documentation of the <a class="el" href="group__client.html#gae7fbcff469df2e638429d3d2cbc9c17e">CC_Mqtt5ErrorLogCb</a> callback function definition.</p>
<h1><a class="anchor" id="cc_mqtt5_client_init"></a>
Client (Re)Initialization</h1>
<p>After all the necessary callbacks have been set, the application must invoke the <b><a class="el" href="group__client.html#gae16f1dae966b8bb63ba38e10bd35df38" title="(Re)Initialize client.">cc_mqtt5_client_init()</a></b> function to allow all other subsequent operations. The function checks that all the necessary callbacks have been set and reinitializes internal data structures. </p><div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__client.html#gae16f1dae966b8bb63ba38e10bd35df38">cc_mqtt5_client_init</a>(client);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    ... <span class="comment">/* Something is wrong, not all callbacks are set */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__client_html_gae16f1dae966b8bb63ba38e10bd35df38"><div class="ttname"><a href="group__client.html#gae16f1dae966b8bb63ba38e10bd35df38">cc_mqtt5_client_init</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_init(CC_Mqtt5ClientHandle handle)</div><div class="ttdoc">(Re)Initialize client.</div></div>
<div class="ttc" id="agroup__global_html_gac9c64dc7d5a785e8b22d7faaaf6f9bea"><div class="ttname"><a href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a></div><div class="ttdeci">CC_Mqtt5ErrorCode</div><div class="ttdoc">Error code returned by various API functions.</div><div class="ttdef"><b>Definition:</b> common.h:65</div></div>
<div class="ttc" id="agroup__global_html_ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63"><div class="ttname"><a href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a></div><div class="ttdeci">@ CC_Mqtt5ErrorCode_Success</div><div class="ttdoc">The requested function executed successfully.</div><div class="ttdef"><b>Definition:</b> common.h:66</div></div>
</div><!-- fragment --><p>Also when broker disconnection is <a class="el" href="index.html#cc_mqtt5_client_callbacks_broker_disconnect">reported</a>, it is necessary to perform re-initialization of the library to be able to re-connect to the broker and continue operation.</p>
<p><b>IMPORTANT:</b> According to the MQTT5 specification, when broker disconnection is reported, the client needs to close network connection. It is a responsibility of the application to do so.</p>
<p>In other words, after the broker disconnection is reported the application is responsible to perform the following steps: </p><ul>
<li>Close the existing network connection. </li>
<li>Re-establish new network connection to the broker. </li>
<li>Re-initialize the client library by invoking <b><a class="el" href="group__client.html#gae16f1dae966b8bb63ba38e10bd35df38" title="(Re)Initialize client.">cc_mqtt5_client_init()</a></b> function.</li>
</ul>
<p>All previously registered callbacks configuration persists and doesn't need to be performed between the re-initialization requests.</p>
<p><b>NOTE</b> that the <b><a class="el" href="group__client.html#gae16f1dae966b8bb63ba38e10bd35df38" title="(Re)Initialize client.">cc_mqtt5_client_init()</a></b> cannot be called from within a callback. For example, if the broker disconnection is reported via <a class="el" href="index.html#cc_mqtt5_client_callbacks_broker_disconnect">callback</a> then the <a class="el" href="index.html#cc_mqtt5_client_init">re-initialization</a> cannot be executed right away. It needs to be postponed until the next event loop iteration.</p>
<p>To check whether the client has gone through the initialization procedure or still needs to be (re)-initialized, the <b><a class="el" href="group__client.html#ga18790eaf31c039cdc0ac638a4ecf674a" title="Check that the client has been (re)initialized.">cc_mqtt5_client_is_initialized()</a></b> function can be used. </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (!<a class="code" href="group__client.html#ga18790eaf31c039cdc0ac638a4ecf674a">cc_mqtt5_client_is_initialized</a>(client)) {</div>
<div class="line">    <a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__client.html#gae16f1dae966b8bb63ba38e10bd35df38">cc_mqtt5_client_init</a>(client);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__client_html_ga18790eaf31c039cdc0ac638a4ecf674a"><div class="ttname"><a href="group__client.html#ga18790eaf31c039cdc0ac638a4ecf674a">cc_mqtt5_client_is_initialized</a></div><div class="ttdeci">bool cc_mqtt5_client_is_initialized(CC_Mqtt5ClientHandle handle)</div><div class="ttdoc">Check that the client has been (re)initialized.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="cc_mqtt5_client_data"></a>
Reporting Incoming Data</h1>
<p>It is the responsibility of the application to receive data from the broker and report it to the library. The report is performed using the <b><a class="el" href="group__client.html#gad3b930c68cc7fd7b9c512bb41f7a974a" title="Provide data (received over I/O link), to the library for processing.">cc_mqtt5_client_process_data()</a></b> function. </p><div class="fragment"><div class="line">uint8_t buf[MAX_BUF_SIZE];</div>
<div class="line">... <span class="comment">// Receive data into buffer</span></div>
<div class="line"><span class="keywordtype">unsigned</span> bufLen = ...; <span class="comment">// Amount of received bytes in the buffer.</span></div>
<div class="line"><span class="keywordtype">unsigned</span> consumed = <a class="code" href="group__client.html#gad3b930c68cc7fd7b9c512bb41f7a974a">cc_mqtt5_client_process_data</a>(client, buf, bufLen);</div>
<div class="line">... <span class="comment">// Remove the first &quot;consumed&quot; bytes from the buffer and retain the rest</span></div>
<div class="line">    <span class="comment">// until the new data chunk arrives.</span></div>
<div class="ttc" id="agroup__client_html_gad3b930c68cc7fd7b9c512bb41f7a974a"><div class="ttname"><a href="group__client.html#gad3b930c68cc7fd7b9c512bb41f7a974a">cc_mqtt5_client_process_data</a></div><div class="ttdeci">unsigned cc_mqtt5_client_process_data(CC_Mqtt5ClientHandle handle, const unsigned char *buf, unsigned bufLen)</div><div class="ttdoc">Provide data (received over I/O link), to the library for processing.</div></div>
</div><!-- fragment --><p> The application is responsible to maintain the input buffer. The value returned from the <b><a class="el" href="group__client.html#gad3b930c68cc7fd7b9c512bb41f7a974a" title="Provide data (received over I/O link), to the library for processing.">cc_mqtt5_client_process_data()</a></b> function reports amount of consumed bytes. In case not all of the reported bytes were consumed the application is responsible to keep them and report again with new appended data when such arrives.</p>
<p>When new data chunk is reported the library may invoke several callbacks, such as reporting received message, sending new data out, as well as canceling the old and programming new tick timeout.</p>
<h1><a class="anchor" id="cc_mqtt5_client_concepts"></a>
Operating Concepts</h1>
<p>The library abstracts away multiple MQTT5 protocol based "operations". Every such operation has multiple stages: </p><ul>
<li><b>prepare</b> - The operation is "allocated" and relevant handle is returned. </li>
<li><b>configure</b> - Apply one or multiple configurations to the prepared operation. </li>
<li><b>send</b> - Send the configured operation message to the broker.</li>
</ul>
<p>During the <b>send</b> stage the application is expected to provide the callback to report to the application when the operation is complete. One of the parameters of the callback is always "status" of the <a class="el" href="group__global.html#gabd56266bda747f19e4c6669fa0da021d">CC_Mqtt5AsyncOpStatus</a> type. It indicates whether the operation was successfully complete. In addition to the status it reports some extra information reported by the broker. The information from the broker is available <b>if and only if</b> the status is <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a>.</p>
<p>The <b>send</b> stage function also returns <a class="el" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> value to indicate whether the <b>send</b> was successfully performed. The provided callback will be invoked <b>if and only if</b> the <b>send</b> returns <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>.</p>
<p>After the <b>send</b> stage the handle returned in the <b>prepare</b> stage can be discarded (no explicit de-allocation is needed / supported) regardless of the return code. After successful <b>send</b> the handle still remains valid until the callback invocation and can be used to <b>cancel</b> the operation. Note that in case the appropriate message has already be <b>sent</b> to the broker, cancelling the outstanding operation can be dangerous. When broker sends a response and client is not expecting it any more, unexpected behaviour (like treating the unexpected message as "protocol error" and disconnecting from the broker) may happen.</p>
<p>In case something went wrong during the <b>configure</b> stage, it is possible to de-allocate the prepared operation using the <b>cancel</b> request. After performing the <b>cancel</b> stage the allocated handle is no longer valid.</p>
<h1><a class="anchor" id="cc_mqtt5_client_response_timeout"></a>
Default Response Timeout</h1>
<p>After sending any operation request to the broker, the client library has to allow some time for the broker to process the request. If it takes too much time, the client must report that operation has failed via the set callback. By default the client library allows 2 seconds for such response to arrive. Changing this default value is possible using the <b><a class="el" href="group__client.html#gab2910d23067c8aab55a1e6f71a4bfff6" title="Configure default response timeout period.">cc_mqtt5_client_set_default_response_timeout()</a></b> function, and retrieving of the currently configured value can be done using the <b><a class="el" href="group__client.html#gaf400f46644bc7fbdbb8246078cdd0133" title="Retrieved currently configured default response timeout period.">cc_mqtt5_client_get_default_response_timeout()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__client.html#gab2910d23067c8aab55a1e6f71a4bfff6">cc_mqtt5_client_set_default_response_timeout</a>(client, 3000 <span class="comment">/* in ms */</span>);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    ... <span class="comment">/* Something went wrong */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__client_html_gab2910d23067c8aab55a1e6f71a4bfff6"><div class="ttname"><a href="group__client.html#gab2910d23067c8aab55a1e6f71a4bfff6">cc_mqtt5_client_set_default_response_timeout</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_set_default_response_timeout(CC_Mqtt5ClientHandle handle, unsigned ms)</div><div class="ttdoc">Configure default response timeout period.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="cc_mqtt5_client_connect"></a>
Connecting to Broker</h1>
<p>To connect to broker use <a class="el" href="group__connect.html">connect</a> operation.</p>
<h2><a class="anchor" id="cc_mqtt5_client_connect_prepare"></a>
Preparing "Connect" Operation.</h2>
<div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>;</div>
<div class="line"><a class="code" href="group__connect.html#ga64101c171371a32ee993fcfa0713b69e">CC_Mqtt5ConnectHandle</a> connect = <a class="code" href="group__connect.html#gac5313c526aa84ded82c0d206ead9683c">cc_mqtt5_client_connect_prepare</a>(client, &amp;ec);</div>
<div class="line"><span class="keywordflow">if</span> (connect == NULL) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Connect allocation failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__connect_html_ga64101c171371a32ee993fcfa0713b69e"><div class="ttname"><a href="group__connect.html#ga64101c171371a32ee993fcfa0713b69e">CC_Mqtt5ConnectHandle</a></div><div class="ttdeci">CC_Mqtt5Connect * CC_Mqtt5ConnectHandle</div><div class="ttdoc">Handle for &quot;connect&quot; operation.</div><div class="ttdef"><b>Definition:</b> common.h:201</div></div>
<div class="ttc" id="agroup__connect_html_gac5313c526aa84ded82c0d206ead9683c"><div class="ttname"><a href="group__connect.html#gac5313c526aa84ded82c0d206ead9683c">cc_mqtt5_client_connect_prepare</a></div><div class="ttdeci">CC_Mqtt5ConnectHandle cc_mqtt5_client_connect_prepare(CC_Mqtt5ClientHandle handle, CC_Mqtt5ErrorCode *ec)</div><div class="ttdoc">Prepare &quot;connect&quot; operation.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="cc_mqtt5_client_connect_response_timeout"></a>
Configuring "Connect" Response Timeout</h2>
<p>When created, the "connect" operation inherits the <a class="el" href="index.html#cc_mqtt5_client_response_timeout">Default Response Timeout</a> configuration. It can be changed for the allocated operation using the <b><a class="el" href="group__connect.html#gaccd7f9371b91bdee6f7b4bbe9a4ec105" title="Configure the broker response timeout for the &quot;connect&quot; operation.">cc_mqtt5_client_connect_set_response_timeout()</a></b> function. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__connect.html#gaccd7f9371b91bdee6f7b4bbe9a4ec105">cc_mqtt5_client_connect_set_response_timeout</a>(connect, 1000);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    ... <span class="comment">/* Something went wrong */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__connect_html_gaccd7f9371b91bdee6f7b4bbe9a4ec105"><div class="ttname"><a href="group__connect.html#gaccd7f9371b91bdee6f7b4bbe9a4ec105">cc_mqtt5_client_connect_set_response_timeout</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_connect_set_response_timeout(CC_Mqtt5ConnectHandle handle, unsigned ms)</div><div class="ttdoc">Configure the broker response timeout for the &quot;connect&quot; operation.</div></div>
</div><!-- fragment --><p> To retrieve the configured response timeout use the <b><a class="el" href="group__connect.html#ga834ff2ca7a48639017b02b1cd7c49836" title="Retrieve the configured the broker response timeout for the &quot;connect&quot; operation.">cc_mqtt5_client_connect_get_response_timeout()</a></b> function.</p>
<h2><a class="anchor" id="cc_mqtt5_client_connect_basic"></a>
Basic Configuration of "Connect" Operation</h2>
<p>The "basic" configuration means no extra MQTT5 properties assigned to the message. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5ConnectBasicConfig.html">CC_Mqtt5ConnectBasicConfig</a> basicConfig;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign default values to the &quot;basicConfig&quot;</span></div>
<div class="line"><a class="code" href="group__connect.html#ga6798ba478859c2302951caa386a6273d">cc_mqtt5_client_connect_init_config_basic</a>(&amp;basicConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Update the values if needed:</span></div>
<div class="line">basicConfig.<a class="code" href="structCC__Mqtt5ConnectBasicConfig.html#a5a2dbd16e540b8e1973f0654aa0fdea4">m_clientId</a> = <span class="stringliteral">&quot;some_client&quot;</span>;</div>
<div class="line">basicConfig.<a class="code" href="structCC__Mqtt5ConnectBasicConfig.html#aa22c441b602c07612e77164c95a4fde2">m_cleanStart</a> = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the configuration</span></div>
<div class="line">ec = <a class="code" href="group__connect.html#gaf2a947ad8801a6d2cc3b0d68981b5308">cc_mqtt5_client_connect_config_basic</a>(connect, &amp;basicConfig);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Basic configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__connect_html_ga6798ba478859c2302951caa386a6273d"><div class="ttname"><a href="group__connect.html#ga6798ba478859c2302951caa386a6273d">cc_mqtt5_client_connect_init_config_basic</a></div><div class="ttdeci">void cc_mqtt5_client_connect_init_config_basic(CC_Mqtt5ConnectBasicConfig *config)</div><div class="ttdoc">Intialize the CC_Mqtt5ConnectBasicConfig configuration structure.</div></div>
<div class="ttc" id="agroup__connect_html_gaf2a947ad8801a6d2cc3b0d68981b5308"><div class="ttname"><a href="group__connect.html#gaf2a947ad8801a6d2cc3b0d68981b5308">cc_mqtt5_client_connect_config_basic</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_connect_config_basic(CC_Mqtt5ConnectHandle handle, const CC_Mqtt5ConnectBasicConfig *config)</div><div class="ttdoc">Perform basic configuration of the &quot;connect&quot; operation.</div></div>
<div class="ttc" id="astructCC__Mqtt5ConnectBasicConfig_html"><div class="ttname"><a href="structCC__Mqtt5ConnectBasicConfig.html">CC_Mqtt5ConnectBasicConfig</a></div><div class="ttdoc">Configuration structure to be passed to the cc_mqtt5_client_connect_config_basic().</div><div class="ttdef"><b>Definition:</b> common.h:266</div></div>
<div class="ttc" id="astructCC__Mqtt5ConnectBasicConfig_html_a5a2dbd16e540b8e1973f0654aa0fdea4"><div class="ttname"><a href="structCC__Mqtt5ConnectBasicConfig.html#a5a2dbd16e540b8e1973f0654aa0fdea4">CC_Mqtt5ConnectBasicConfig::m_clientId</a></div><div class="ttdeci">const char * m_clientId</div><div class="ttdoc">Zero terminated Client ID string, can be NULL. When NULL means empty &quot;Client ID&quot;. Defaults to NULL.</div><div class="ttdef"><b>Definition:</b> common.h:267</div></div>
<div class="ttc" id="astructCC__Mqtt5ConnectBasicConfig_html_aa22c441b602c07612e77164c95a4fde2"><div class="ttname"><a href="structCC__Mqtt5ConnectBasicConfig.html#aa22c441b602c07612e77164c95a4fde2">CC_Mqtt5ConnectBasicConfig::m_cleanStart</a></div><div class="ttdeci">bool m_cleanStart</div><div class="ttdoc">Clean start flag, defaults to false.</div><div class="ttdef"><b>Definition:</b> common.h:272</div></div>
</div><!-- fragment --><p><b>IMPORTANT</b>: MQTT5 specification allows reconnection to the broker while requesting previous session restoration (via "clean start" bit). To prevent potential errors of the client and broker inner states being out of sync, the <b>first</b> "connect" operation requires setting the <a class="el" href="structCC__Mqtt5ConnectBasicConfig.html#aa22c441b602c07612e77164c95a4fde2">CC_Mqtt5ConnectBasicConfig::m_cleanStart</a> value to <b>true</b>. Otherwise the <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8614c000b8e812823b6ccf446eb09c94">CC_Mqtt5ErrorCode_BadParam</a> error code will be returned. Any subsequent reconnection attempts will allow setting the value to <b>false</b>.</p>
<p>See also documentation of the <a class="el" href="structCC__Mqtt5ConnectBasicConfig.html">CC_Mqtt5ConnectBasicConfig</a> structure.</p>
<h2><a class="anchor" id="cc_mqtt5_client_connect_will"></a>
Will Configuration</h2>
<p>To perform will configuration use the <b><a class="el" href="group__connect.html#ga958c2fbc2dd9d159fe8786a3053e3706" title="Perform will configuration of the &quot;connect&quot; operation.">cc_mqtt5_client_connect_config_will()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5ConnectWillConfig.html">CC_Mqtt5ConnectWillConfig</a> willConfig;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign default values to the configuration</span></div>
<div class="line"><a class="code" href="group__connect.html#ga9afb95116fc0575d2f527e8cc0fd9555">cc_mqtt5_client_connect_init_config_will</a>(&amp;willConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Update values if needed</span></div>
<div class="line">willConfig.<a class="code" href="structCC__Mqtt5ConnectWillConfig.html#acbb9be662292684093052b2ced18e52d">m_topic</a> = <span class="stringliteral">&quot;some/topic&quot;</span>;</div>
<div class="line">willConfig.<a class="code" href="structCC__Mqtt5ConnectWillConfig.html#a011b29aee3e59aa22eac4e641da2f0e5">m_data</a> = ...;</div>
<div class="line">willConfig.<a class="code" href="structCC__Mqtt5ConnectWillConfig.html#ad87361e3b8dc8e5f870354cf35d68610">m_dataLen</a> = ...;</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the configuration</span></div>
<div class="line">ec = <a class="code" href="group__connect.html#ga958c2fbc2dd9d159fe8786a3053e3706">cc_mqtt5_client_connect_config_will</a>(connect, &amp;willConfig);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Will configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__connect_html_ga958c2fbc2dd9d159fe8786a3053e3706"><div class="ttname"><a href="group__connect.html#ga958c2fbc2dd9d159fe8786a3053e3706">cc_mqtt5_client_connect_config_will</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_connect_config_will(CC_Mqtt5ConnectHandle handle, const CC_Mqtt5ConnectWillConfig *config)</div><div class="ttdoc">Perform will configuration of the &quot;connect&quot; operation.</div></div>
<div class="ttc" id="agroup__connect_html_ga9afb95116fc0575d2f527e8cc0fd9555"><div class="ttname"><a href="group__connect.html#ga9afb95116fc0575d2f527e8cc0fd9555">cc_mqtt5_client_connect_init_config_will</a></div><div class="ttdeci">void cc_mqtt5_client_connect_init_config_will(CC_Mqtt5ConnectWillConfig *config)</div><div class="ttdoc">Intialize the CC_Mqtt5ConnectWillConfig configuration structure.</div></div>
<div class="ttc" id="astructCC__Mqtt5ConnectWillConfig_html"><div class="ttname"><a href="structCC__Mqtt5ConnectWillConfig.html">CC_Mqtt5ConnectWillConfig</a></div><div class="ttdoc">Configuration structure to be passed to the cc_mqtt5_client_connect_config_will().</div><div class="ttdef"><b>Definition:</b> common.h:279</div></div>
<div class="ttc" id="astructCC__Mqtt5ConnectWillConfig_html_a011b29aee3e59aa22eac4e641da2f0e5"><div class="ttname"><a href="structCC__Mqtt5ConnectWillConfig.html#a011b29aee3e59aa22eac4e641da2f0e5">CC_Mqtt5ConnectWillConfig::m_data</a></div><div class="ttdeci">const unsigned char * m_data</div><div class="ttdoc">Will message data, can be NULL. Defaults to NULL.</div><div class="ttdef"><b>Definition:</b> common.h:281</div></div>
<div class="ttc" id="astructCC__Mqtt5ConnectWillConfig_html_acbb9be662292684093052b2ced18e52d"><div class="ttname"><a href="structCC__Mqtt5ConnectWillConfig.html#acbb9be662292684093052b2ced18e52d">CC_Mqtt5ConnectWillConfig::m_topic</a></div><div class="ttdeci">const char * m_topic</div><div class="ttdoc">Will topic string, must NOT be NULL or empty. Defaults to NULL.</div><div class="ttdef"><b>Definition:</b> common.h:280</div></div>
<div class="ttc" id="astructCC__Mqtt5ConnectWillConfig_html_ad87361e3b8dc8e5f870354cf35d68610"><div class="ttname"><a href="structCC__Mqtt5ConnectWillConfig.html#ad87361e3b8dc8e5f870354cf35d68610">CC_Mqtt5ConnectWillConfig::m_dataLen</a></div><div class="ttdeci">unsigned m_dataLen</div><div class="ttdoc">Number of will data bytes. When 0 means no data. Defaults to 0.</div><div class="ttdef"><b>Definition:</b> common.h:282</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5ConnectWillConfig.html">CC_Mqtt5ConnectWillConfig</a> structure.</p>
<p><b>IMPORTANT:</b> The <b><a class="el" href="group__connect.html#ga958c2fbc2dd9d159fe8786a3053e3706" title="Perform will configuration of the &quot;connect&quot; operation.">cc_mqtt5_client_connect_config_will()</a></b> function mustn't be called more than once for a single "connect" operation. Otherwise it may result in setting multiple will properties of the same type, which is the "Protocol Error" according to the MQTT5 specification.</p>
<p>The MQTT5 specification allows adding several "User Properties" specific to the will. The library allows such assignment using multiple invocations of the <b><a class="el" href="group__connect.html#gaa715d923d1159828488fec4815d16de0" title="Add user property to the will configuration of the &quot;connect&quot; operation.">cc_mqtt5_client_connect_add_will_user_prop()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> prop;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#af0ad9b0d643a2e9222f7810c586f9c08">m_key</a> = <span class="stringliteral">&quot;some_key&quot;</span>;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#a63bde874936587bd145b6209164a6969">m_value</a> = <span class="stringliteral">&quot;some_value&quot;</span>;</div>
<div class="line">ec = <a class="code" href="group__connect.html#gaa715d923d1159828488fec4815d16de0">cc_mqtt5_client_connect_add_will_user_prop</a>(connect, &amp;prop);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Will user property configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__connect_html_gaa715d923d1159828488fec4815d16de0"><div class="ttname"><a href="group__connect.html#gaa715d923d1159828488fec4815d16de0">cc_mqtt5_client_connect_add_will_user_prop</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_connect_add_will_user_prop(CC_Mqtt5ConnectHandle handle, const CC_Mqtt5UserProp *prop)</div><div class="ttdoc">Add user property to the will configuration of the &quot;connect&quot; operation.</div></div>
<div class="ttc" id="astructCC__Mqtt5UserProp_html"><div class="ttname"><a href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a></div><div class="ttdoc">Wraping structre of the single &quot;User Property&quot;.</div><div class="ttdef"><b>Definition:</b> common.h:257</div></div>
<div class="ttc" id="astructCC__Mqtt5UserProp_html_a63bde874936587bd145b6209164a6969"><div class="ttname"><a href="structCC__Mqtt5UserProp.html#a63bde874936587bd145b6209164a6969">CC_Mqtt5UserProp::m_value</a></div><div class="ttdeci">const char * m_value</div><div class="ttdoc">Value string, can be NULL.</div><div class="ttdef"><b>Definition:</b> common.h:259</div></div>
<div class="ttc" id="astructCC__Mqtt5UserProp_html_af0ad9b0d643a2e9222f7810c586f9c08"><div class="ttname"><a href="structCC__Mqtt5UserProp.html#af0ad9b0d643a2e9222f7810c586f9c08">CC_Mqtt5UserProp::m_key</a></div><div class="ttdeci">const char * m_key</div><div class="ttdoc">Key string, mustn't be NULL.</div><div class="ttdef"><b>Definition:</b> common.h:258</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> structure.</p>
<h2><a class="anchor" id="cc_mqtt5_client_connect_extra"></a>
Extra Properties Configuration</h2>
<p>To add extra MQTT5 specific properties to the connection request use <b><a class="el" href="group__connect.html#ga0250a9dc06f6637b836badddc3723935" title="Perform extra properties configuration of the &quot;connect&quot; operation.">cc_mqtt5_client_connect_config_extra()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5ConnectExtraConfig.html">CC_Mqtt5ConnectExtraConfig</a> extraConfig;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the configuration structure to the default values</span></div>
<div class="line"><a class="code" href="group__connect.html#gab8b32bbed7147c10f4b80e4c98f183c6">cc_mqtt5_client_connect_init_config_extra</a>(&amp;extraConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign necessary properties:</span></div>
<div class="line">extraConfig.<a class="code" href="structCC__Mqtt5ConnectExtraConfig.html#af473dd3f19fd748259f35297e4e75fb1">m_sessionExpiryInterval</a> = 5;</div>
<div class="line">extraConfig.<a class="code" href="structCC__Mqtt5ConnectExtraConfig.html#a52e2fed9ba0a306dff58ef8c2b6bf52f">m_topicAliasMaximum</a> = 20;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the configuration</span></div>
<div class="line">ec = <a class="code" href="group__connect.html#ga0250a9dc06f6637b836badddc3723935">cc_mqtt5_client_connect_config_extra</a>(connect, &amp;extraConfig);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Extra properties configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__connect_html_ga0250a9dc06f6637b836badddc3723935"><div class="ttname"><a href="group__connect.html#ga0250a9dc06f6637b836badddc3723935">cc_mqtt5_client_connect_config_extra</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_connect_config_extra(CC_Mqtt5ConnectHandle handle, const CC_Mqtt5ConnectExtraConfig *config)</div><div class="ttdoc">Perform extra properties configuration of the &quot;connect&quot; operation.</div></div>
<div class="ttc" id="agroup__connect_html_gab8b32bbed7147c10f4b80e4c98f183c6"><div class="ttname"><a href="group__connect.html#gab8b32bbed7147c10f4b80e4c98f183c6">cc_mqtt5_client_connect_init_config_extra</a></div><div class="ttdeci">void cc_mqtt5_client_connect_init_config_extra(CC_Mqtt5ConnectExtraConfig *config)</div><div class="ttdoc">Intialize the CC_Mqtt5ConnectWillConfig configuration structure.</div></div>
<div class="ttc" id="astructCC__Mqtt5ConnectExtraConfig_html"><div class="ttname"><a href="structCC__Mqtt5ConnectExtraConfig.html">CC_Mqtt5ConnectExtraConfig</a></div><div class="ttdoc">Extra properties configuration of the &quot;connect&quot; operation.</div><div class="ttdef"><b>Definition:</b> common.h:298</div></div>
<div class="ttc" id="astructCC__Mqtt5ConnectExtraConfig_html_a52e2fed9ba0a306dff58ef8c2b6bf52f"><div class="ttname"><a href="structCC__Mqtt5ConnectExtraConfig.html#a52e2fed9ba0a306dff58ef8c2b6bf52f">CC_Mqtt5ConnectExtraConfig::m_topicAliasMaximum</a></div><div class="ttdeci">unsigned m_topicAliasMaximum</div><div class="ttdoc">&quot;Topic Alias Maximum&quot; property, defaults to 0, not added when 0.</div><div class="ttdef"><b>Definition:</b> common.h:303</div></div>
<div class="ttc" id="astructCC__Mqtt5ConnectExtraConfig_html_af473dd3f19fd748259f35297e4e75fb1"><div class="ttname"><a href="structCC__Mqtt5ConnectExtraConfig.html#af473dd3f19fd748259f35297e4e75fb1">CC_Mqtt5ConnectExtraConfig::m_sessionExpiryInterval</a></div><div class="ttdeci">unsigned m_sessionExpiryInterval</div><div class="ttdoc">&quot;Session Expiry Interval&quot; property, defaults to 0, not added when 0.</div><div class="ttdef"><b>Definition:</b> common.h:299</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5ConnectExtraConfig.html">CC_Mqtt5ConnectExtraConfig</a> structure.</p>
<p><b>IMPORTANT:</b> The <b><a class="el" href="group__connect.html#ga0250a9dc06f6637b836badddc3723935" title="Perform extra properties configuration of the &quot;connect&quot; operation.">cc_mqtt5_client_connect_config_extra()</a></b> function mustn't be called more than once for a single "connect" operation. Otherwise it may result in setting multiple properties of the same type, which is the "Protocol Error" according to the MQTT5 specification.</p>
<h2><a class="anchor" id="cc_mqtt5_client_connect_auth"></a>
Extended Authentication Handshake Configuration</h2>
<p>In case the extended authentication handshake is needed use <b><a class="el" href="group__connect.html#ga7fd264379469afc148b33e03733a062b" title="Perform authentication handshake configuration of the &quot;connect&quot; operation.">cc_mqtt5_client_connect_config_auth()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="group__global.html#gaa2b0e4ecc24bfd83703e722793a0bca1">CC_Mqtt5AuthErrorCode</a> my_auth_handshake_cb(<span class="keywordtype">void</span>* data, <span class="keyword">const</span> <a class="code" href="structCC__Mqtt5AuthInfo.html">CC_Mqtt5AuthInfo</a>* authInfoIn, <a class="code" href="structCC__Mqtt5AuthInfo.html">CC_Mqtt5AuthInfo</a>* authInfoOut)</div>
<div class="line">{</div>
<div class="line">    ... <span class="comment">// Analyse authInfoIn</span></div>
<div class="line">    <span class="keywordflow">if</span> (auth_failed) {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__global.html#ggaa2b0e4ecc24bfd83703e722793a0bca1adea033704c194c4d575eee5d7f6c111f">CC_Mqtt5AuthErrorCode_Disconnect</a>; <span class="comment">// terminate handshake with error</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ... <span class="comment">// Populate authInfoOut</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__global.html#ggaa2b0e4ecc24bfd83703e722793a0bca1a73da94a53d477ad876e2a3133137fb30">CC_Mqtt5AuthErrorCode_Continue</a>; <span class="comment">// continue handshake</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="structCC__Mqtt5AuthConfig.html">CC_Mqtt5AuthConfig</a> authConfig;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the configuration structure to the default values</span></div>
<div class="line"><a class="code" href="group__connect.html#ga778ba2d75104e5362a25c3715d32570a">cc_mqtt5_client_connect_init_config_auth</a>(&amp;authConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign all the necessary values</span></div>
<div class="line">authConfig.<a class="code" href="structCC__Mqtt5AuthConfig.html#abad1e68933d95a4bd391d3debe9e585e">m_authMethod</a> = <span class="stringliteral">&quot;some_method&quot;</span></div>
<div class="line">authConfig.<a class="code" href="structCC__Mqtt5AuthConfig.html#a689c2e51c3fd0a27105f8fde47e67e89">m_authData</a> = ...;</div>
<div class="line">authConfig.<a class="code" href="structCC__Mqtt5AuthConfig.html#a35b9e67dfc077f8b2731cbd234362851">m_authDataLen</a> = ...;</div>
<div class="line">authConfig.<a class="code" href="structCC__Mqtt5AuthConfig.html#a60dc71b1ead1becc3b61181fa0d965a4">m_authCb</a> = &amp;my_auth_handshake_cb;</div>
<div class="line">authConfig.<a class="code" href="structCC__Mqtt5AuthConfig.html#a25b1bc5f096cb8b588c5119e2e1d6e6c">m_authCbData</a> = ...;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the configuration</span></div>
<div class="line">ec = <a class="code" href="group__connect.html#ga7fd264379469afc148b33e03733a062b">cc_mqtt5_client_connect_config_auth</a>(connect, &amp;authConfig);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Authentication handshake configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__connect_html_ga778ba2d75104e5362a25c3715d32570a"><div class="ttname"><a href="group__connect.html#ga778ba2d75104e5362a25c3715d32570a">cc_mqtt5_client_connect_init_config_auth</a></div><div class="ttdeci">void cc_mqtt5_client_connect_init_config_auth(CC_Mqtt5AuthConfig *config)</div><div class="ttdoc">Intialize the CC_Mqtt5AuthConfig configuration structure.</div></div>
<div class="ttc" id="agroup__connect_html_ga7fd264379469afc148b33e03733a062b"><div class="ttname"><a href="group__connect.html#ga7fd264379469afc148b33e03733a062b">cc_mqtt5_client_connect_config_auth</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_connect_config_auth(CC_Mqtt5ConnectHandle handle, const CC_Mqtt5AuthConfig *config)</div><div class="ttdoc">Perform authentication handshake configuration of the &quot;connect&quot; operation.</div></div>
<div class="ttc" id="agroup__global_html_gaa2b0e4ecc24bfd83703e722793a0bca1"><div class="ttname"><a href="group__global.html#gaa2b0e4ecc24bfd83703e722793a0bca1">CC_Mqtt5AuthErrorCode</a></div><div class="ttdeci">CC_Mqtt5AuthErrorCode</div><div class="ttdoc">Error code returned by the CC_Mqtt5AuthCb callback.</div><div class="ttdef"><b>Definition:</b> common.h:111</div></div>
<div class="ttc" id="agroup__global_html_ggaa2b0e4ecc24bfd83703e722793a0bca1a73da94a53d477ad876e2a3133137fb30"><div class="ttname"><a href="group__global.html#ggaa2b0e4ecc24bfd83703e722793a0bca1a73da94a53d477ad876e2a3133137fb30">CC_Mqtt5AuthErrorCode_Continue</a></div><div class="ttdeci">@ CC_Mqtt5AuthErrorCode_Continue</div><div class="ttdoc">Continue the authentication process.</div><div class="ttdef"><b>Definition:</b> common.h:112</div></div>
<div class="ttc" id="agroup__global_html_ggaa2b0e4ecc24bfd83703e722793a0bca1adea033704c194c4d575eee5d7f6c111f"><div class="ttname"><a href="group__global.html#ggaa2b0e4ecc24bfd83703e722793a0bca1adea033704c194c4d575eee5d7f6c111f">CC_Mqtt5AuthErrorCode_Disconnect</a></div><div class="ttdeci">@ CC_Mqtt5AuthErrorCode_Disconnect</div><div class="ttdoc">Stop the authentication, send DISCONNECT to broker.</div><div class="ttdef"><b>Definition:</b> common.h:113</div></div>
<div class="ttc" id="astructCC__Mqtt5AuthConfig_html"><div class="ttname"><a href="structCC__Mqtt5AuthConfig.html">CC_Mqtt5AuthConfig</a></div><div class="ttdoc">Authentication Configuration.</div><div class="ttdef"><b>Definition:</b> common.h:600</div></div>
<div class="ttc" id="astructCC__Mqtt5AuthConfig_html_a25b1bc5f096cb8b588c5119e2e1d6e6c"><div class="ttname"><a href="structCC__Mqtt5AuthConfig.html#a25b1bc5f096cb8b588c5119e2e1d6e6c">CC_Mqtt5AuthConfig::m_authCbData</a></div><div class="ttdeci">void * m_authCbData</div><div class="ttdoc">Pointer to user data object, passed as first parameter to the &quot;m_authCb&quot; callback.</div><div class="ttdef"><b>Definition:</b> common.h:605</div></div>
<div class="ttc" id="astructCC__Mqtt5AuthConfig_html_a35b9e67dfc077f8b2731cbd234362851"><div class="ttname"><a href="structCC__Mqtt5AuthConfig.html#a35b9e67dfc077f8b2731cbd234362851">CC_Mqtt5AuthConfig::m_authDataLen</a></div><div class="ttdeci">unsigned m_authDataLen</div><div class="ttdoc">Amount of bytes in the authentication data buffer.</div><div class="ttdef"><b>Definition:</b> common.h:603</div></div>
<div class="ttc" id="astructCC__Mqtt5AuthConfig_html_a60dc71b1ead1becc3b61181fa0d965a4"><div class="ttname"><a href="structCC__Mqtt5AuthConfig.html#a60dc71b1ead1becc3b61181fa0d965a4">CC_Mqtt5AuthConfig::m_authCb</a></div><div class="ttdeci">CC_Mqtt5AuthCb m_authCb</div><div class="ttdoc">Callback to be invoked during the authentication handshake.</div><div class="ttdef"><b>Definition:</b> common.h:604</div></div>
<div class="ttc" id="astructCC__Mqtt5AuthConfig_html_a689c2e51c3fd0a27105f8fde47e67e89"><div class="ttname"><a href="structCC__Mqtt5AuthConfig.html#a689c2e51c3fd0a27105f8fde47e67e89">CC_Mqtt5AuthConfig::m_authData</a></div><div class="ttdeci">const unsigned char * m_authData</div><div class="ttdoc">Pointer to the authentication data buffer, can be NULL.</div><div class="ttdef"><b>Definition:</b> common.h:602</div></div>
<div class="ttc" id="astructCC__Mqtt5AuthConfig_html_abad1e68933d95a4bd391d3debe9e585e"><div class="ttname"><a href="structCC__Mqtt5AuthConfig.html#abad1e68933d95a4bd391d3debe9e585e">CC_Mqtt5AuthConfig::m_authMethod</a></div><div class="ttdeci">const char * m_authMethod</div><div class="ttdoc">Authentication method string, must NOT be NULL.</div><div class="ttdef"><b>Definition:</b> common.h:601</div></div>
<div class="ttc" id="astructCC__Mqtt5AuthInfo_html"><div class="ttname"><a href="structCC__Mqtt5AuthInfo.html">CC_Mqtt5AuthInfo</a></div><div class="ttdoc">Authentication handshake information.</div><div class="ttdef"><b>Definition:</b> common.h:337</div></div>
</div><!-- fragment --><p> During the "connect" operation, both client and the broker can exchange multiple <b>AUTH</b> messages. When such message arrive the library will invoke provided handshake callback. The responsibility of the callback is to analyze the incoming authentication data and populate the response information. The client can fail the handshake by returning the <a class="el" href="group__global.html#ggaa2b0e4ecc24bfd83703e722793a0bca1adea033704c194c4d575eee5d7f6c111f">CC_Mqtt5AuthErrorCode_Disconnect</a> instead of the <a class="el" href="group__global.html#ggaa2b0e4ecc24bfd83703e722793a0bca1a73da94a53d477ad876e2a3133137fb30">CC_Mqtt5AuthErrorCode_Continue</a>.</p>
<p>When client side fails the authentication, the <b>DISCONNECT</b> message is sent to the broker and "connect" operation callback (see <a class="el" href="index.html#cc_mqtt5_client_connect_send">Sending Connection Request</a> below) will be invoked with <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da805071d40ad1703c18988178c52804ff">CC_Mqtt5AsyncOpStatus_Aborted</a> as status report. The broker disconnection report <a class="el" href="index.html#cc_mqtt5_client_callbacks_broker_disconnect">callback</a> will <b>NOT</b> be invoked, because the connection hasn't really happened yet.</p>
<p><b>IMPORTANT:</b> The <b><a class="el" href="group__connect.html#ga7fd264379469afc148b33e03733a062b" title="Perform authentication handshake configuration of the &quot;connect&quot; operation.">cc_mqtt5_client_connect_config_auth()</a></b> function mustn't be called more than once for a single "connect" operation. Otherwise it may result in setting multiple properties of the same type, which is the "Protocol Error" according to the MQTT5 specification.</p>
<h2><a class="anchor" id="cc_mqtt5_client_connect_user_prop"></a>
Adding "User Properties"</h2>
<p>The MQTT5 specification allows attaching any number of the "User Properties" to the <b>CONNECT</b> message. The library allows such assignment using multiple invocations of the <b><a class="el" href="group__connect.html#ga84bd7822005fe1a5d6c0775395633bc8" title="Add user property to the configuration of the &quot;connect&quot; operation.">cc_mqtt5_client_connect_add_user_prop()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> prop;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#af0ad9b0d643a2e9222f7810c586f9c08">m_key</a> = <span class="stringliteral">&quot;some_key&quot;</span>;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#a63bde874936587bd145b6209164a6969">m_value</a> = <span class="stringliteral">&quot;some_value&quot;</span>;</div>
<div class="line">ec = <a class="code" href="group__connect.html#ga84bd7822005fe1a5d6c0775395633bc8">cc_mqtt5_client_connect_add_user_prop</a>(connect, &amp;prop);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: User property configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__connect_html_ga84bd7822005fe1a5d6c0775395633bc8"><div class="ttname"><a href="group__connect.html#ga84bd7822005fe1a5d6c0775395633bc8">cc_mqtt5_client_connect_add_user_prop</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_connect_add_user_prop(CC_Mqtt5ConnectHandle handle, const CC_Mqtt5UserProp *prop)</div><div class="ttdoc">Add user property to the configuration of the &quot;connect&quot; operation.</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> structure.</p>
<h2><a class="anchor" id="cc_mqtt5_client_connect_send"></a>
Sending Connection Request</h2>
<p>When all the necessary configurations are performed for the allocated "connect" operation it can actually be sent to the broker. To initiate sending use the <b><a class="el" href="group__connect.html#gab07a79afeddf50c2c0e8c442bf3c14e3" title="Send the configured &quot;connect&quot; operation to broker.">cc_mqtt5_client_connect_send()</a></b> function. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> my_connect_complete_cb(<span class="keywordtype">void</span>* data, <a class="code" href="group__global.html#gabd56266bda747f19e4c6669fa0da021d">CC_Mqtt5AsyncOpStatus</a> status, <span class="keyword">const</span> <a class="code" href="structCC__Mqtt5ConnectResponse.html">CC_Mqtt5ConnectResponse</a>* response)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;ERROR: The connection operation has failed with status=%d\n&quot;</span>, status);</div>
<div class="line">        ... <span class="comment">// handle error.</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// &quot;response&quot; is not NULL when status is CC_Mqtt5AsyncOpStatus_Complete.</span></div>
<div class="line">    assert(response != NULL);</div>
<div class="line">    ... <span class="comment">// Analyze response values.</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">ec = <a class="code" href="group__connect.html#gab07a79afeddf50c2c0e8c442bf3c14e3">cc_mqtt5_client_connect_send</a>(connect, &amp;my_connect_complete_cb, data);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to send connect request with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__connect_html_gab07a79afeddf50c2c0e8c442bf3c14e3"><div class="ttname"><a href="group__connect.html#gab07a79afeddf50c2c0e8c442bf3c14e3">cc_mqtt5_client_connect_send</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_connect_send(CC_Mqtt5ConnectHandle handle, CC_Mqtt5ConnectCompleteCb cb, void *cbData)</div><div class="ttdoc">Send the configured &quot;connect&quot; operation to broker.</div></div>
<div class="ttc" id="agroup__global_html_gabd56266bda747f19e4c6669fa0da021d"><div class="ttname"><a href="group__global.html#gabd56266bda747f19e4c6669fa0da021d">CC_Mqtt5AsyncOpStatus</a></div><div class="ttdeci">CC_Mqtt5AsyncOpStatus</div><div class="ttdoc">Status of the asynchronous operation.</div><div class="ttdef"><b>Definition:</b> common.h:96</div></div>
<div class="ttc" id="agroup__global_html_ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d"><div class="ttname"><a href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a></div><div class="ttdeci">@ CC_Mqtt5AsyncOpStatus_Complete</div><div class="ttdoc">The requested operation has been completed, refer to reported extra details for information.</div><div class="ttdef"><b>Definition:</b> common.h:97</div></div>
<div class="ttc" id="astructCC__Mqtt5ConnectResponse_html"><div class="ttname"><a href="structCC__Mqtt5ConnectResponse.html">CC_Mqtt5ConnectResponse</a></div><div class="ttdoc">Response information from broker to &quot;connect&quot; request.</div><div class="ttdef"><b>Definition:</b> common.h:311</div></div>
</div><!-- fragment --><p> The provided callback will be invoked when the "connect" operation is complete <b> if and only if</b> the function returns <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>.</p>
<p>The handle returned by the <b><a class="el" href="group__connect.html#gac5313c526aa84ded82c0d206ead9683c" title="Prepare &quot;connect&quot; operation.">cc_mqtt5_client_connect_prepare()</a></b> function can be discarded (there is no free / de-allocation) right after the <b><a class="el" href="group__connect.html#gab07a79afeddf50c2c0e8c442bf3c14e3" title="Send the configured &quot;connect&quot; operation to broker.">cc_mqtt5_client_connect_send()</a></b> invocation regardless of the returned error code. However, the handle remains valid until the callback is called (in case the <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a> was returned). The valid handle can be used to <a class="el" href="index.html#cc_mqtt5_client_connect_cancel">cancel</a> the operation before the completion callback is invoked.</p>
<p>When the "connect" operation completion callback is invoked the reported "response" information is present <b>if and only if</b> the "status" is <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a>.</p>
<p><b>NOTE</b> that only single "connect" operation is allowed at a time, any attempt to prepare a new one via <b><a class="el" href="group__connect.html#gac5313c526aa84ded82c0d206ead9683c" title="Prepare &quot;connect&quot; operation.">cc_mqtt5_client_connect_prepare()</a></b> will be rejected until the "connect" operation completion callback is invoked or the operation is <a class="el" href="index.html#cc_mqtt5_client_connect_cancel">cancelled</a>.</p>
<p><b>IMPORTANT:</b> The <a class="el" href="structCC__Mqtt5ConnectResponse.html">response</a> information from the broker may report that some features on the broker side are disabled. The library will reject any subsequent operation configuration which contradict the broker's capabilities. For example, attempt to subscribe to the topic containing wildcards, when the reported <a class="el" href="structCC__Mqtt5ConnectResponse.html#af64300d0cf50f4785184a875b53c20b2">CC_Mqtt5ConnectResponse::m_wildcardSubAvailable</a> is <b>false</b>, will be rejected with <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8614c000b8e812823b6ccf446eb09c94">CC_Mqtt5ErrorCode_BadParam</a>.</p>
<p>Quote from the MQTT5 specification: </p><div class="fragment"><div class="line">If a Server sends a CONNACK packet containing a Reason code of 128 or greater</div>
<div class="line">it MUST then close the Network Connection [MQTT-3.2.2-7]</div>
</div><!-- fragment --><p> When the callback reporting the connection status is invoked, it is responsibility of the application to check the <a class="el" href="structCC__Mqtt5ConnectResponse.html#a24dae42dadf8a42b036dadd24218bf1e">CC_Mqtt5ConnectResponse::m_reasonCode</a> value. If it's <a class="el" href="group__global.html#gga7231ab939f4dd41f18a27ed953fda977af6b53fd67e10ddb82f83106298405dfe">CC_Mqtt5ReasonCode_UnspecifiedError</a> or greater, the application is responsible to close the network connection and go through the <a class="el" href="index.html#cc_mqtt5_client_init">re-initialization</a> process. The same should be done when the "connect" operation is not properly completed, i.e. the reported status is <b>NOT</b> <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a>.</p>
<h2><a class="anchor" id="cc_mqtt5_client_connect_cancel"></a>
Cancel the "Connect" Operation.</h2>
<p>While the handle returned by the <b><a class="el" href="group__connect.html#gac5313c526aa84ded82c0d206ead9683c" title="Prepare &quot;connect&quot; operation.">cc_mqtt5_client_connect_prepare()</a></b> is still valid it is possible to cancel / discard the operation. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__connect.html#ga3a86f0f55eca32b031c931e211077856">cc_mqtt5_client_connect_cancel</a>(connect);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to cancel connect with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__connect_html_ga3a86f0f55eca32b031c931e211077856"><div class="ttname"><a href="group__connect.html#ga3a86f0f55eca32b031c931e211077856">cc_mqtt5_client_connect_cancel</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_connect_cancel(CC_Mqtt5ConnectHandle handle)</div><div class="ttdoc">Cancel the allocated &quot;connect&quot; operation.</div></div>
</div><!-- fragment --><p> In case the <b><a class="el" href="group__connect.html#gab07a79afeddf50c2c0e8c442bf3c14e3" title="Send the configured &quot;connect&quot; operation to broker.">cc_mqtt5_client_connect_send()</a></b> function was successfully called before the <b><a class="el" href="group__connect.html#ga3a86f0f55eca32b031c931e211077856" title="Cancel the allocated &quot;connect&quot; operation.">cc_mqtt5_client_connect_cancel()</a></b>, the operation is cancelled <b>without</b> callback invocation.</p>
<h2><a class="anchor" id="cc_mqtt5_client_connect_check"></a>
Check The Library Remains Connected</h2>
<p>At any time it is possible to check the internal state of the library of whether it's properly connected to the broker. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> isConnected = <a class="code" href="group__connect.html#ga83bc38c4588aac4d6d77bb53d1bc6f4c">cc_mqtt5_client_is_connected</a>(client);</div>
<div class="ttc" id="agroup__connect_html_ga83bc38c4588aac4d6d77bb53d1bc6f4c"><div class="ttname"><a href="group__connect.html#ga83bc38c4588aac4d6d77bb53d1bc6f4c">cc_mqtt5_client_is_connected</a></div><div class="ttdeci">bool cc_mqtt5_client_is_connected(CC_Mqtt5ClientHandle handle)</div><div class="ttdoc">Check the inner state of the library of whether it's connected to the broker.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="cc_mqtt5_client_disconnect"></a>
Disconnecting From Broker</h1>
<p>To intentionally disconnect from broker use <a class="el" href="group__disconnect.html">disconnect</a> operation. The unsolicited disconnection from the broker is described in ref <a class="el" href="index.html#cc_mqtt5_client_unsolicited_disconnect">Unsolicited Broker Disconnection</a> section below.</p>
<h2><a class="anchor" id="cc_mqtt5_client_disconnect_prepare"></a>
Preparing "Disconnect" Operation.</h2>
<div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>;</div>
<div class="line"><a class="code" href="group__disconnect.html#ga92b8550723ef32e1f15578b428cab05d">CC_Mqtt5DisconnectHandle</a> disconnect = <a class="code" href="group__disconnect.html#ga6a5de1f9260e525c1b21d755bdd0c8c8">cc_mqtt5_client_disconnect_prepare</a>(client, &amp;ec);</div>
<div class="line"><span class="keywordflow">if</span> (disconnect == NULL) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Disconnect allocation failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__disconnect_html_ga6a5de1f9260e525c1b21d755bdd0c8c8"><div class="ttname"><a href="group__disconnect.html#ga6a5de1f9260e525c1b21d755bdd0c8c8">cc_mqtt5_client_disconnect_prepare</a></div><div class="ttdeci">CC_Mqtt5DisconnectHandle cc_mqtt5_client_disconnect_prepare(CC_Mqtt5ClientHandle handle, CC_Mqtt5ErrorCode *ec)</div><div class="ttdoc">Prepare &quot;disconnect&quot; operation.</div></div>
<div class="ttc" id="agroup__disconnect_html_ga92b8550723ef32e1f15578b428cab05d"><div class="ttname"><a href="group__disconnect.html#ga92b8550723ef32e1f15578b428cab05d">CC_Mqtt5DisconnectHandle</a></div><div class="ttdeci">CC_Mqtt5Disconnect * CC_Mqtt5DisconnectHandle</div><div class="ttdoc">Handle for &quot;disconnect&quot; operation.</div><div class="ttdef"><b>Definition:</b> common.h:210</div></div>
</div><!-- fragment --><h2><a class="anchor" id="cc_mqtt5_client_disconnect_config"></a>
Configuration of "Disconnect" Operation</h2>
<p>The configuration of the "disconnect" operation is performed using a single <b><a class="el" href="group__disconnect.html#gad45d98e9ff983aa7e80353738f2a6df8" title="Perform configuration of the &quot;disconnect&quot; operation.">cc_mqtt5_client_disconnect_config()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5DisconnectConfig.html">CC_Mqtt5DisconnectConfig</a> config;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign default values to the &quot;config&quot;</span></div>
<div class="line"><a class="code" href="group__disconnect.html#ga09031ff47aa6452c9161bfb53ace4b6a">cc_mqtt5_client_disconnect_init_config</a>(&amp;config);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Update the values if needed:</span></div>
<div class="line">config.<a class="code" href="structCC__Mqtt5DisconnectConfig.html#a88971bad96852e18f7a173eee40de7b3">m_reasonCode</a> = <a class="code" href="group__global.html#gga7231ab939f4dd41f18a27ed953fda977ad9553e1ccbc0520aade4221743514dc9">CC_Mqtt5ReasonCode_DisconnectWithWill</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the configuration</span></div>
<div class="line">ec = <a class="code" href="group__disconnect.html#gad45d98e9ff983aa7e80353738f2a6df8">cc_mqtt5_client_disconnect_config</a>(disconnect, &amp;config);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Disconnect configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__disconnect_html_ga09031ff47aa6452c9161bfb53ace4b6a"><div class="ttname"><a href="group__disconnect.html#ga09031ff47aa6452c9161bfb53ace4b6a">cc_mqtt5_client_disconnect_init_config</a></div><div class="ttdeci">void cc_mqtt5_client_disconnect_init_config(CC_Mqtt5DisconnectConfig *config)</div><div class="ttdoc">Intialize the CC_Mqtt5DisconnectConfig configuration structure.</div></div>
<div class="ttc" id="agroup__disconnect_html_gad45d98e9ff983aa7e80353738f2a6df8"><div class="ttname"><a href="group__disconnect.html#gad45d98e9ff983aa7e80353738f2a6df8">cc_mqtt5_client_disconnect_config</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_disconnect_config(CC_Mqtt5DisconnectHandle handle, const CC_Mqtt5DisconnectConfig *config)</div><div class="ttdoc">Perform configuration of the &quot;disconnect&quot; operation.</div></div>
<div class="ttc" id="agroup__global_html_gga7231ab939f4dd41f18a27ed953fda977ad9553e1ccbc0520aade4221743514dc9"><div class="ttname"><a href="group__global.html#gga7231ab939f4dd41f18a27ed953fda977ad9553e1ccbc0520aade4221743514dc9">CC_Mqtt5ReasonCode_DisconnectWithWill</a></div><div class="ttdeci">@ CC_Mqtt5ReasonCode_DisconnectWithWill</div><div class="ttdoc">value Disconnect w/ Will.</div><div class="ttdef"><b>Definition:</b> common.h:126</div></div>
<div class="ttc" id="astructCC__Mqtt5DisconnectConfig_html"><div class="ttname"><a href="structCC__Mqtt5DisconnectConfig.html">CC_Mqtt5DisconnectConfig</a></div><div class="ttdoc">Configuration structure of the &quot;disconnect&quot; operation.</div><div class="ttdef"><b>Definition:</b> common.h:358</div></div>
<div class="ttc" id="astructCC__Mqtt5DisconnectConfig_html_a88971bad96852e18f7a173eee40de7b3"><div class="ttname"><a href="structCC__Mqtt5DisconnectConfig.html#a88971bad96852e18f7a173eee40de7b3">CC_Mqtt5DisconnectConfig::m_reasonCode</a></div><div class="ttdeci">CC_Mqtt5ReasonCode m_reasonCode</div><div class="ttdoc">&quot;Reason Code&quot; to report to the broker</div><div class="ttdef"><b>Definition:</b> common.h:359</div></div>
</div><!-- fragment --><h2><a class="anchor" id="cc_mqtt5_client_disconnect_user_prop"></a>
Adding "User Properties"</h2>
<p>The MQTT5 specification allows attaching any number of the "User Properties" to the <b>DISCONNECT</b> message. The library allows such assignment using multiple invocations of the <b><a class="el" href="group__disconnect.html#ga21fa077f13b88908dadc016daa5b941f" title="Add user property to the configuration of the &quot;disconnect&quot; operation.">cc_mqtt5_client_disconnect_add_user_prop()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> prop;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#af0ad9b0d643a2e9222f7810c586f9c08">m_key</a> = <span class="stringliteral">&quot;some_key&quot;</span>;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#a63bde874936587bd145b6209164a6969">m_value</a> = <span class="stringliteral">&quot;some_value&quot;</span>;</div>
<div class="line">ec = <a class="code" href="group__disconnect.html#ga21fa077f13b88908dadc016daa5b941f">cc_mqtt5_client_disconnect_add_user_prop</a>(disconnect, &amp;prop);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: User property configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__disconnect_html_ga21fa077f13b88908dadc016daa5b941f"><div class="ttname"><a href="group__disconnect.html#ga21fa077f13b88908dadc016daa5b941f">cc_mqtt5_client_disconnect_add_user_prop</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_disconnect_add_user_prop(CC_Mqtt5DisconnectHandle handle, const CC_Mqtt5UserProp *prop)</div><div class="ttdoc">Add user property to the configuration of the &quot;disconnect&quot; operation.</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> structure.</p>
<h2><a class="anchor" id="cc_mqtt5_client_disconnect_send"></a>
Sending Disconnection Request</h2>
<p>When the necessary configuration is performed for the allocated "disconnect" operation it can be sent to the broker. To initiate sending use the <b><a class="el" href="group__disconnect.html#ga69e8c99ae3299cd3b51eeb4ffae41925" title="Send the configured &quot;disconnect&quot; operation to broker.">cc_mqtt5_client_disconnect_send()</a></b> function. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__disconnect.html#ga69e8c99ae3299cd3b51eeb4ffae41925">cc_mqtt5_client_disconnect_send</a>(disconnect);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to send disconnect request with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
<div class="line">assert(!<a class="code" href="group__connect.html#ga83bc38c4588aac4d6d77bb53d1bc6f4c">cc_mqtt5_client_is_connected</a>(client)); <span class="comment">// Expect immediate disconnection after the successful send</span></div>
<div class="ttc" id="agroup__disconnect_html_ga69e8c99ae3299cd3b51eeb4ffae41925"><div class="ttname"><a href="group__disconnect.html#ga69e8c99ae3299cd3b51eeb4ffae41925">cc_mqtt5_client_disconnect_send</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_disconnect_send(CC_Mqtt5DisconnectHandle handle)</div><div class="ttdoc">Send the configured &quot;disconnect&quot; operation to broker.</div></div>
</div><!-- fragment --><p> <b>NOTE</b> that the <b><a class="el" href="group__disconnect.html#ga69e8c99ae3299cd3b51eeb4ffae41925" title="Send the configured &quot;disconnect&quot; operation to broker.">cc_mqtt5_client_disconnect_send()</a></b> function doesn't receive any callback because there is no expected response to the <b>DISCONNECT</b> message from the broker. The disconnection effect is immediate. The application is expected to terminate the network connection and go through <a class="el" href="index.html#cc_mqtt5_client_init">re-initialization</a> process if necessary. The handle returned by the <b><a class="el" href="group__disconnect.html#ga6a5de1f9260e525c1b21d755bdd0c8c8" title="Prepare &quot;disconnect&quot; operation.">cc_mqtt5_client_disconnect_prepare()</a></b> must be discarded.</p>
<p>In case there are other asynchronous operations that hasn't been completed yet, their completion callback is automatically invoked with <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da805071d40ad1703c18988178c52804ff">CC_Mqtt5AsyncOpStatus_Aborted</a> status.</p>
<p><b>IMPORTANT:</b> In case of sending the explicit disconnection request the <a class="el" href="index.html#cc_mqtt5_client_callbacks_broker_disconnect">registered unsolicited disconnection callback</a> is <b>NOT</b> invoked.</p>
<h2><a class="anchor" id="cc_mqtt5_client_disconnect_cancel"></a>
Cancel the "Disconnect" Operation.</h2>
<p>While the handle returned by the <b><a class="el" href="group__disconnect.html#ga6a5de1f9260e525c1b21d755bdd0c8c8" title="Prepare &quot;disconnect&quot; operation.">cc_mqtt5_client_disconnect_prepare()</a></b> is still valid it is possible to cancel / discard the operation. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__disconnect.html#ga6e99be30da8691287e769ba1135850d5">cc_mqtt5_client_disconnect_cancel</a>(disconnect);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to cancel disconnect with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__disconnect_html_ga6e99be30da8691287e769ba1135850d5"><div class="ttname"><a href="group__disconnect.html#ga6e99be30da8691287e769ba1135850d5">cc_mqtt5_client_disconnect_cancel</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_disconnect_cancel(CC_Mqtt5DisconnectHandle handle)</div><div class="ttdoc">Cancel the allocated &quot;disconnect&quot; operation.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="cc_mqtt5_client_subscribe"></a>
Subscribing to Receive Messages</h1>
<p>To subscribe to receive incoming messages use <a class="el" href="group__subscribe.html">subscribe</a> operation. The application can issue multiple "subscribe" operations in parallel.</p>
<h2><a class="anchor" id="cc_mqtt5_client_subscribe_prepare"></a>
Preparing "Subscribe" Operation.</h2>
<div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>;</div>
<div class="line"><a class="code" href="group__subscribe.html#ga6fbdce35052d6cbd1cb0e5e3995b4ccd">CC_Mqtt5SubscribeHandle</a> subscribe = <a class="code" href="group__subscribe.html#ga1cbf32eb3f9d11ae96e50d9570deb403">cc_mqtt5_client_subscribe_prepare</a>(client, &amp;ec);</div>
<div class="line"><span class="keywordflow">if</span> (subscribe == NULL) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Subscribe allocation failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__subscribe_html_ga1cbf32eb3f9d11ae96e50d9570deb403"><div class="ttname"><a href="group__subscribe.html#ga1cbf32eb3f9d11ae96e50d9570deb403">cc_mqtt5_client_subscribe_prepare</a></div><div class="ttdeci">CC_Mqtt5SubscribeHandle cc_mqtt5_client_subscribe_prepare(CC_Mqtt5ClientHandle handle, CC_Mqtt5ErrorCode *ec)</div><div class="ttdoc">Prepare &quot;subscribe&quot; operation.</div></div>
<div class="ttc" id="agroup__subscribe_html_ga6fbdce35052d6cbd1cb0e5e3995b4ccd"><div class="ttname"><a href="group__subscribe.html#ga6fbdce35052d6cbd1cb0e5e3995b4ccd">CC_Mqtt5SubscribeHandle</a></div><div class="ttdeci">CC_Mqtt5Subscribe * CC_Mqtt5SubscribeHandle</div><div class="ttdoc">Handle for &quot;subscribe&quot; operation.</div><div class="ttdef"><b>Definition:</b> common.h:219</div></div>
</div><!-- fragment --><h2><a class="anchor" id="cc_mqtt5_client_subscribe_response_timeout"></a>
Configuring "Subscribe" Response Timeout</h2>
<p>When created, the "subscribe" operation inherits the <a class="el" href="index.html#cc_mqtt5_client_response_timeout">Default Response Timeout</a> configuration. It can be changed for the allocated operation using the <b><a class="el" href="group__subscribe.html#ga2bb2748e02ed4ec2fe11f3525f39b10e" title="Configure the broker response timeout for the &quot;subscribe&quot; operation.">cc_mqtt5_client_subscribe_set_response_timeout()</a></b> function. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__subscribe.html#ga2bb2748e02ed4ec2fe11f3525f39b10e">cc_mqtt5_client_subscribe_set_response_timeout</a>(subscribe, 1000);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    ... <span class="comment">/* Something went wrong */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__subscribe_html_ga2bb2748e02ed4ec2fe11f3525f39b10e"><div class="ttname"><a href="group__subscribe.html#ga2bb2748e02ed4ec2fe11f3525f39b10e">cc_mqtt5_client_subscribe_set_response_timeout</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_subscribe_set_response_timeout(CC_Mqtt5SubscribeHandle handle, unsigned ms)</div><div class="ttdoc">Configure the broker response timeout for the &quot;subscribe&quot; operation.</div></div>
</div><!-- fragment --><p> To retrieve the configured response timeout use the <b><a class="el" href="group__subscribe.html#gabcf467b326c8117a7ba95b21540c7b39" title="Retrieve the configured the broker response timeout for the &quot;subscribe&quot; operation.">cc_mqtt5_client_subscribe_get_response_timeout()</a></b> function.</p>
<h2><a class="anchor" id="cc_mqtt5_client_subscribe_topic"></a>
Topic Configuration</h2>
<p>Single <b>SUBSCRIBE</b> message can carry multiple topic subscriptions. Use separate <b><a class="el" href="group__subscribe.html#ga2f344bdcb7224dd2a2371f982117e4f7" title="Add topic configuration of the &quot;subscribe&quot; operation.">cc_mqtt5_client_subscribe_config_topic()</a></b> function invocation to configure each such subscription. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5SubscribeTopicConfig.html">CC_Mqtt5SubscribeTopicConfig</a> topicConfig;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign default values to the configuration</span></div>
<div class="line"><a class="code" href="group__subscribe.html#gabeff7363174cab7ab34bb045af931df9">cc_mqtt5_client_subscribe_init_config_topic</a>(&amp;topicConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Update values if needed</span></div>
<div class="line">topicConfig.<a class="code" href="structCC__Mqtt5SubscribeTopicConfig.html#a6554f4cb616f58f95c0000b1b80fb6b8">m_topic</a> = <span class="stringliteral">&quot;some/topic&quot;</span>;</div>
<div class="line">topicConfig.<a class="code" href="structCC__Mqtt5SubscribeTopicConfig.html#a6c5f7e0e1ed68c645872e397fc700120">m_noLocal</a> = <span class="keyword">true</span>;</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the configuration</span></div>
<div class="line">ec = <a class="code" href="group__subscribe.html#ga2f344bdcb7224dd2a2371f982117e4f7">cc_mqtt5_client_subscribe_config_topic</a>(subscribe, &amp;topicConfig);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Topic configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__subscribe_html_ga2f344bdcb7224dd2a2371f982117e4f7"><div class="ttname"><a href="group__subscribe.html#ga2f344bdcb7224dd2a2371f982117e4f7">cc_mqtt5_client_subscribe_config_topic</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_subscribe_config_topic(CC_Mqtt5SubscribeHandle handle, const CC_Mqtt5SubscribeTopicConfig *config)</div><div class="ttdoc">Add topic configuration of the &quot;subscribe&quot; operation.</div></div>
<div class="ttc" id="agroup__subscribe_html_gabeff7363174cab7ab34bb045af931df9"><div class="ttname"><a href="group__subscribe.html#gabeff7363174cab7ab34bb045af931df9">cc_mqtt5_client_subscribe_init_config_topic</a></div><div class="ttdeci">void cc_mqtt5_client_subscribe_init_config_topic(CC_Mqtt5SubscribeTopicConfig *config)</div><div class="ttdoc">Intialize the CC_Mqtt5SubscribeTopicConfig configuration structure.</div></div>
<div class="ttc" id="astructCC__Mqtt5SubscribeTopicConfig_html"><div class="ttname"><a href="structCC__Mqtt5SubscribeTopicConfig.html">CC_Mqtt5SubscribeTopicConfig</a></div><div class="ttdoc">Topic filter configuration structure of the &quot;subscribe&quot; operation.</div><div class="ttdef"><b>Definition:</b> common.h:368</div></div>
<div class="ttc" id="astructCC__Mqtt5SubscribeTopicConfig_html_a6554f4cb616f58f95c0000b1b80fb6b8"><div class="ttname"><a href="structCC__Mqtt5SubscribeTopicConfig.html#a6554f4cb616f58f95c0000b1b80fb6b8">CC_Mqtt5SubscribeTopicConfig::m_topic</a></div><div class="ttdeci">const char * m_topic</div><div class="ttdoc">&quot;Topic Filter&quot; string, mustn't be NULL</div><div class="ttdef"><b>Definition:</b> common.h:369</div></div>
<div class="ttc" id="astructCC__Mqtt5SubscribeTopicConfig_html_a6c5f7e0e1ed68c645872e397fc700120"><div class="ttname"><a href="structCC__Mqtt5SubscribeTopicConfig.html#a6c5f7e0e1ed68c645872e397fc700120">CC_Mqtt5SubscribeTopicConfig::m_noLocal</a></div><div class="ttdeci">bool m_noLocal</div><div class="ttdoc">&quot;No Local&quot; subscription option, defaults to false.</div><div class="ttdef"><b>Definition:</b> common.h:372</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5SubscribeTopicConfig.html">CC_Mqtt5SubscribeTopicConfig</a> structure.</p>
<p>By default the library will perform the analysis of the submitted topic format and reject it if topic format is incorrect. However, for performance reasons it is possible to disable such verification when client application ensures that no invalid topics are used. That includes not submitting topics with wildcards when the broker doesn't support them (see <a class="el" href="structCC__Mqtt5ConnectResponse.html">CC_Mqtt5ConnectResponse</a>), or not using shared subscription for the same reason. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__client.html#gacbfe7d85c9f3c373bdf7bb5473616b35">cc_mqtt5_client_set_verify_outgoing_topic_enabled</a>(client, <span class="keyword">false</span>);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    ... <span class="comment">/* Something is wrong */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__client_html_gacbfe7d85c9f3c373bdf7bb5473616b35"><div class="ttname"><a href="group__client.html#gacbfe7d85c9f3c373bdf7bb5473616b35">cc_mqtt5_client_set_verify_outgoing_topic_enabled</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_set_verify_outgoing_topic_enabled(CC_Mqtt5ClientHandle handle, bool enabled)</div><div class="ttdoc">Control outgoing topic format verification.</div></div>
</div><!-- fragment --><p> <b>NOTE</b> that the configuration is global per client and not per "subscribe" operation.</p>
<p>Also <b>note</b> that the same function controls the verification of the "subscribe", "unsubscribe" and "publish" topic formats.</p>
<p>To retrieve the current configuration use <b><a class="el" href="group__client.html#ga58897f8539e72671602cc3fc8e9ac19f" title="Retrieve current outgoing topic format verification control.">cc_mqtt5_client_get_verify_outgoing_topic_enabled()</a></b> function.</p>
<h2><a class="anchor" id="cc_mqtt5_client_subscribe_extra"></a>
Extra Properties Configuration</h2>
<p>To add extra MQTT5 specific properties to the subscription request use <b><a class="el" href="group__subscribe.html#ga2de37f3b0f17471d26d3488cc3f9a446" title="Perform extra properties configuration of the &quot;subscribe&quot; operation.">cc_mqtt5_client_subscribe_config_extra()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5SubscribeExtraConfig.html">CC_Mqtt5SubscribeExtraConfig</a> extraConfig;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign default values to the configuration</span></div>
<div class="line"><a class="code" href="group__subscribe.html#gaff1b806c1b382a7a41fabf09f2928577">cc_mqtt5_client_subscribe_init_config_extra</a>(&amp;extraConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign necessary properties:</span></div>
<div class="line">extraConfig.<a class="code" href="structCC__Mqtt5SubscribeExtraConfig.html#a1e0414fa71b9485cc7cec3bb2af98bf3">m_subId</a> = ...;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the configuration</span></div>
<div class="line">ec = <a class="code" href="group__subscribe.html#ga2de37f3b0f17471d26d3488cc3f9a446">cc_mqtt5_client_subscribe_config_extra</a>(subscribe, &amp;extraConfig);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Extra properties configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__subscribe_html_ga2de37f3b0f17471d26d3488cc3f9a446"><div class="ttname"><a href="group__subscribe.html#ga2de37f3b0f17471d26d3488cc3f9a446">cc_mqtt5_client_subscribe_config_extra</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_subscribe_config_extra(CC_Mqtt5SubscribeHandle handle, const CC_Mqtt5SubscribeExtraConfig *config)</div><div class="ttdoc">Perform extra properties configuration of the &quot;subscribe&quot; operation.</div></div>
<div class="ttc" id="agroup__subscribe_html_gaff1b806c1b382a7a41fabf09f2928577"><div class="ttname"><a href="group__subscribe.html#gaff1b806c1b382a7a41fabf09f2928577">cc_mqtt5_client_subscribe_init_config_extra</a></div><div class="ttdeci">void cc_mqtt5_client_subscribe_init_config_extra(CC_Mqtt5SubscribeExtraConfig *config)</div><div class="ttdoc">Intialize the CC_Mqtt5SubscribeExtraConfig configuration structure.</div></div>
<div class="ttc" id="astructCC__Mqtt5SubscribeExtraConfig_html"><div class="ttname"><a href="structCC__Mqtt5SubscribeExtraConfig.html">CC_Mqtt5SubscribeExtraConfig</a></div><div class="ttdoc">Extra subscription properties configuration structure.</div><div class="ttdef"><b>Definition:</b> common.h:380</div></div>
<div class="ttc" id="astructCC__Mqtt5SubscribeExtraConfig_html_a1e0414fa71b9485cc7cec3bb2af98bf3"><div class="ttname"><a href="structCC__Mqtt5SubscribeExtraConfig.html#a1e0414fa71b9485cc7cec3bb2af98bf3">CC_Mqtt5SubscribeExtraConfig::m_subId</a></div><div class="ttdeci">unsigned m_subId</div><div class="ttdoc">&quot;Subscription Identifier&quot; property, defaults to invalid value of 0.</div><div class="ttdef"><b>Definition:</b> common.h:381</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5SubscribeExtraConfig.html">CC_Mqtt5SubscribeExtraConfig</a> structure.</p>
<p><b>Note</b> that explicitly initializing the <a class="el" href="structCC__Mqtt5SubscribeExtraConfig.html">CC_Mqtt5SubscribeExtraConfig</a> configuration object is not really necessary, because it has only a single <a class="el" href="structCC__Mqtt5SubscribeExtraConfig.html#a1e0414fa71b9485cc7cec3bb2af98bf3">CC_Mqtt5SubscribeExtraConfig::m_subId</a> member, which is going to be overwritten as part of the configuration. However, calling the <b><a class="el" href="group__subscribe.html#gaff1b806c1b382a7a41fabf09f2928577" title="Intialize the CC_Mqtt5SubscribeExtraConfig configuration structure.">cc_mqtt5_client_subscribe_init_config_extra()</a></b> is still recommended to make the application's code future updates proof. Potentially the MQTT5 specification and as the result this library can be updated by adding new property to the <a class="el" href="structCC__Mqtt5SubscribeExtraConfig.html">CC_Mqtt5SubscribeExtraConfig</a> struct. Having the "unnecessary" call to the <b><a class="el" href="group__subscribe.html#gaff1b806c1b382a7a41fabf09f2928577" title="Intialize the CC_Mqtt5SubscribeExtraConfig configuration structure.">cc_mqtt5_client_subscribe_init_config_extra()</a></b> function makes sure that newly added property gets initialized to the default value without any need to update the application's code.</p>
<p>Also note that allocating and managing the "Subscription Identifier" property values is completely application's responsibility. The broker is responsible to report the assigned value when sending relevant message, and the client can use the reported value for easier dispatching of the received message to appropriate handling functionality.</p>
<h2><a class="anchor" id="cc_mqtt5_client_subscribe_user_prop"></a>
Adding "User Properties"</h2>
<p>The MQTT5 specification allows attaching any number of the "User Properties" to the <b>SUBSCRIBE</b> message. The library allows such assignment using multiple invocations of the <b><a class="el" href="group__subscribe.html#ga48fad52b98d93cb7d952c9bae76857e2" title="Add user property to the configuration of the &quot;subscribe&quot; operation.">cc_mqtt5_client_subscribe_add_user_prop()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> prop;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#af0ad9b0d643a2e9222f7810c586f9c08">m_key</a> = <span class="stringliteral">&quot;some_key&quot;</span>;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#a63bde874936587bd145b6209164a6969">m_value</a> = <span class="stringliteral">&quot;some_value&quot;</span>;</div>
<div class="line">ec = <a class="code" href="group__subscribe.html#ga48fad52b98d93cb7d952c9bae76857e2">cc_mqtt5_client_subscribe_add_user_prop</a>(subscribe, &amp;prop);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: User property configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__subscribe_html_ga48fad52b98d93cb7d952c9bae76857e2"><div class="ttname"><a href="group__subscribe.html#ga48fad52b98d93cb7d952c9bae76857e2">cc_mqtt5_client_subscribe_add_user_prop</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_subscribe_add_user_prop(CC_Mqtt5SubscribeHandle handle, const CC_Mqtt5UserProp *prop)</div><div class="ttdoc">Add user property to the configuration of the &quot;subscribe&quot; operation.</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> structure.</p>
<h2><a class="anchor" id="cc_mqtt5_client_subscribe_send"></a>
Sending Subscription Request</h2>
<p>When all the necessary configurations are performed for the allocated "subscribe" operation it can actually be sent to the broker. To initiate sending use the <b><a class="el" href="group__subscribe.html#gadaeca4f9381ece1a7d23bb4a7a3ea7c8" title="Send the configured &quot;subscribe&quot; operation to broker.">cc_mqtt5_client_subscribe_send()</a></b> function. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> my_subscribe_complete_cb(<span class="keywordtype">void</span>* data, <a class="code" href="group__subscribe.html#ga6fbdce35052d6cbd1cb0e5e3995b4ccd">CC_Mqtt5SubscribeHandle</a> handle, <a class="code" href="group__global.html#gabd56266bda747f19e4c6669fa0da021d">CC_Mqtt5AsyncOpStatus</a> status, <span class="keyword">const</span> <a class="code" href="structCC__Mqtt5SubscribeResponse.html">CC_Mqtt5SubscribeResponse</a>* response)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;ERROR: The subscription operation has failed with status=%d\n&quot;</span>, status);</div>
<div class="line">        ... <span class="comment">// handle error.</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// &quot;response&quot; is not NULL when status is CC_Mqtt5AsyncOpStatus_Complete.</span></div>
<div class="line">    assert(response != NULL);</div>
<div class="line">    ... <span class="comment">// Analyze response values.</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">ec = <a class="code" href="group__subscribe.html#gadaeca4f9381ece1a7d23bb4a7a3ea7c8">cc_mqtt5_client_subscribe_send</a>(subscribe, &amp;my_subscribe_complete_cb, data);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to send subscribe request with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__subscribe_html_gadaeca4f9381ece1a7d23bb4a7a3ea7c8"><div class="ttname"><a href="group__subscribe.html#gadaeca4f9381ece1a7d23bb4a7a3ea7c8">cc_mqtt5_client_subscribe_send</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_subscribe_send(CC_Mqtt5SubscribeHandle handle, CC_Mqtt5SubscribeCompleteCb cb, void *cbData)</div><div class="ttdoc">Send the configured &quot;subscribe&quot; operation to broker.</div></div>
<div class="ttc" id="astructCC__Mqtt5SubscribeResponse_html"><div class="ttname"><a href="structCC__Mqtt5SubscribeResponse.html">CC_Mqtt5SubscribeResponse</a></div><div class="ttdoc">Response information from broker to &quot;subscribe&quot; request.</div><div class="ttdef"><b>Definition:</b> common.h:387</div></div>
</div><!-- fragment --><p> The provided callback will be invoked when the "subscribe" operation is complete <b> if and only if</b> the function returns <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>.</p>
<p>The handle returned by the <b><a class="el" href="group__subscribe.html#ga1cbf32eb3f9d11ae96e50d9570deb403" title="Prepare &quot;subscribe&quot; operation.">cc_mqtt5_client_subscribe_prepare()</a></b> function can be discarded (there is no free / de-allocation) right after the <b><a class="el" href="group__subscribe.html#gadaeca4f9381ece1a7d23bb4a7a3ea7c8" title="Send the configured &quot;subscribe&quot; operation to broker.">cc_mqtt5_client_subscribe_send()</a></b> invocation regardless of the returned error code. However, the handle remains valid until the callback is called (in case the <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a> was returned). The valid handle can be used to <a class="el" href="index.html#cc_mqtt5_client_subscribe_cancel">cancel</a> the operation before the completion callback is invoked.</p>
<p>Note that the callback function receives the "subscribe" operation handle as its second parameter. Although the handle is already invalid and cannot be used in any other function, it allows the application to identify the original "subscribe" request if multiple have been issued in parallel and use the same callback function for all of them.</p>
<p>When the "subscribe" operation completion callback is invoked the reported "response" information is present <b>if and only if</b> the "status" is <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a>.</p>
<h2><a class="anchor" id="cc_mqtt5_client_subscribe_cancel"></a>
Cancel the "Subscribe" Operation.</h2>
<p>While the handle returned by the <b><a class="el" href="group__subscribe.html#ga1cbf32eb3f9d11ae96e50d9570deb403" title="Prepare &quot;subscribe&quot; operation.">cc_mqtt5_client_subscribe_prepare()</a></b> is still valid it is possible to cancel / discard the operation. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__subscribe.html#ga7c531c03aa1f45a139aa6c89dbd5cae5">cc_mqtt5_client_subscribe_cancel</a>(subscribe);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to cancel subscribe with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__subscribe_html_ga7c531c03aa1f45a139aa6c89dbd5cae5"><div class="ttname"><a href="group__subscribe.html#ga7c531c03aa1f45a139aa6c89dbd5cae5">cc_mqtt5_client_subscribe_cancel</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_subscribe_cancel(CC_Mqtt5SubscribeHandle handle)</div><div class="ttdoc">Cancel the allocated &quot;subscribe&quot; operation.</div></div>
</div><!-- fragment --><p> In case the <b><a class="el" href="group__subscribe.html#gadaeca4f9381ece1a7d23bb4a7a3ea7c8" title="Send the configured &quot;subscribe&quot; operation to broker.">cc_mqtt5_client_subscribe_send()</a></b> function was successfully called before the <b><a class="el" href="group__subscribe.html#ga7c531c03aa1f45a139aa6c89dbd5cae5" title="Cancel the allocated &quot;subscribe&quot; operation.">cc_mqtt5_client_subscribe_cancel()</a></b>, the operation is cancelled <b>without</b> callback invocation.</p>
<h1><a class="anchor" id="cc_mqtt5_client_unsubscribe"></a>
Unsubscribing from Message Reception</h1>
<p>To unsubscribe from receiving incoming messages use <a class="el" href="group__unsubscribe.html">unsubscribe</a> operation. The application can issue multiple "unsubscribe" operations in parallel.</p>
<h2><a class="anchor" id="cc_mqtt5_client_unsubscribe_prepare"></a>
Preparing "Unsubscribe" Operation.</h2>
<div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>;</div>
<div class="line"><a class="code" href="group__unsubscribe.html#ga7ab1c795bfe02334906f1ecc0be921e5">CC_Mqtt5UnsubscribeHandle</a> unsubscribe = <a class="code" href="group__unsubscribe.html#ga902e65feaa5337fd659a9851569397ec">cc_mqtt5_client_unsubscribe_prepare</a>(client, &amp;ec);</div>
<div class="line"><span class="keywordflow">if</span> (unsubscribe == NULL) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Unsubscribe allocation failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__unsubscribe_html_ga7ab1c795bfe02334906f1ecc0be921e5"><div class="ttname"><a href="group__unsubscribe.html#ga7ab1c795bfe02334906f1ecc0be921e5">CC_Mqtt5UnsubscribeHandle</a></div><div class="ttdeci">CC_Mqtt5Unsubscribe * CC_Mqtt5UnsubscribeHandle</div><div class="ttdoc">Handle for &quot;unsubscribe&quot; operation.</div><div class="ttdef"><b>Definition:</b> common.h:228</div></div>
<div class="ttc" id="agroup__unsubscribe_html_ga902e65feaa5337fd659a9851569397ec"><div class="ttname"><a href="group__unsubscribe.html#ga902e65feaa5337fd659a9851569397ec">cc_mqtt5_client_unsubscribe_prepare</a></div><div class="ttdeci">CC_Mqtt5UnsubscribeHandle cc_mqtt5_client_unsubscribe_prepare(CC_Mqtt5ClientHandle handle, CC_Mqtt5ErrorCode *ec)</div><div class="ttdoc">Prepare &quot;unsubscribe&quot; operation.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="cc_mqtt5_client_unsubscribe_response_timeout"></a>
Configuring "Unsubscribe" Response Timeout</h2>
<p>When created, the "unsubscribe" operation inherits the <a class="el" href="index.html#cc_mqtt5_client_response_timeout">Default Response Timeout</a> configuration. It can be changed for the allocated operation using the <b><a class="el" href="group__unsubscribe.html#ga5d61e66afa3339156e8f3c4b0a95189d" title="Configure the broker response timeout for the &quot;unsubscribe&quot; operation.">cc_mqtt5_client_unsubscribe_set_response_timeout()</a></b> function. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__unsubscribe.html#ga5d61e66afa3339156e8f3c4b0a95189d">cc_mqtt5_client_unsubscribe_set_response_timeout</a>(unsubscribe, 1000);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    ... <span class="comment">/* Something went wrong */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__unsubscribe_html_ga5d61e66afa3339156e8f3c4b0a95189d"><div class="ttname"><a href="group__unsubscribe.html#ga5d61e66afa3339156e8f3c4b0a95189d">cc_mqtt5_client_unsubscribe_set_response_timeout</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_unsubscribe_set_response_timeout(CC_Mqtt5UnsubscribeHandle handle, unsigned ms)</div><div class="ttdoc">Configure the broker response timeout for the &quot;unsubscribe&quot; operation.</div></div>
</div><!-- fragment --><p> To retrieve the configured response timeout use the <b><a class="el" href="group__unsubscribe.html#gaa916a8974746da7b6dc35440b10d0fbf" title="Retrieve the configured the broker response timeout for the &quot;unsubscribe&quot; operation.">cc_mqtt5_client_unsubscribe_get_response_timeout()</a></b> function.</p>
<h2><a class="anchor" id="cc_mqtt5_client_unsubscribe_topic"></a>
Topic Configuration</h2>
<p>Single <b>UNSUBSCRIBE</b> message can carry multiple topic unsubscriptions. Use <b><a class="el" href="group__unsubscribe.html#gafa889944c790b5cef7aa4b8e3853ff69" title="Add topic configuration of the &quot;unsubscribe&quot; operation.">cc_mqtt5_client_unsubscribe_config_topic()</a></b> function to configure each such unsubscription. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5UnsubscribeTopicConfig.html">CC_Mqtt5UnsubscribeTopicConfig</a> topicConfig;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign default values to the configuration</span></div>
<div class="line"><a class="code" href="group__unsubscribe.html#gaafb93baecc28842fe05b502beed046bc">cc_mqtt5_client_unsubscribe_init_config_topic</a>(&amp;topicConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Update values</span></div>
<div class="line">topicConfig.<a class="code" href="structCC__Mqtt5UnsubscribeTopicConfig.html#abc1e6a2792caa6c217d92ef975eb0d49">m_topic</a> = <span class="stringliteral">&quot;some/topic&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the configuration</span></div>
<div class="line">ec = <a class="code" href="group__unsubscribe.html#gafa889944c790b5cef7aa4b8e3853ff69">cc_mqtt5_client_unsubscribe_config_topic</a>(unsubscribe, &amp;topicConfig);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Topic configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__unsubscribe_html_gaafb93baecc28842fe05b502beed046bc"><div class="ttname"><a href="group__unsubscribe.html#gaafb93baecc28842fe05b502beed046bc">cc_mqtt5_client_unsubscribe_init_config_topic</a></div><div class="ttdeci">void cc_mqtt5_client_unsubscribe_init_config_topic(CC_Mqtt5UnsubscribeTopicConfig *config)</div><div class="ttdoc">Intialize the CC_Mqtt5UnsubscribeTopicConfig configuration structure.</div></div>
<div class="ttc" id="agroup__unsubscribe_html_gafa889944c790b5cef7aa4b8e3853ff69"><div class="ttname"><a href="group__unsubscribe.html#gafa889944c790b5cef7aa4b8e3853ff69">cc_mqtt5_client_unsubscribe_config_topic</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_unsubscribe_config_topic(CC_Mqtt5UnsubscribeHandle handle, const CC_Mqtt5UnsubscribeTopicConfig *config)</div><div class="ttdoc">Add topic configuration of the &quot;unsubscribe&quot; operation.</div></div>
<div class="ttc" id="astructCC__Mqtt5UnsubscribeTopicConfig_html"><div class="ttname"><a href="structCC__Mqtt5UnsubscribeTopicConfig.html">CC_Mqtt5UnsubscribeTopicConfig</a></div><div class="ttdoc">Topic filter configuration structure of the &quot;unsubscribe&quot; operation.</div><div class="ttdef"><b>Definition:</b> common.h:399</div></div>
<div class="ttc" id="astructCC__Mqtt5UnsubscribeTopicConfig_html_abc1e6a2792caa6c217d92ef975eb0d49"><div class="ttname"><a href="structCC__Mqtt5UnsubscribeTopicConfig.html#abc1e6a2792caa6c217d92ef975eb0d49">CC_Mqtt5UnsubscribeTopicConfig::m_topic</a></div><div class="ttdeci">const char * m_topic</div><div class="ttdoc">&quot;Topic Filter&quot; string, mustn't be NULL</div><div class="ttdef"><b>Definition:</b> common.h:400</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5UnsubscribeTopicConfig.html">CC_Mqtt5UnsubscribeTopicConfig</a> structure.</p>
<p><b>Note</b> that explicitly initializing the <a class="el" href="structCC__Mqtt5UnsubscribeTopicConfig.html">CC_Mqtt5UnsubscribeTopicConfig</a> configuration object is not really necessary, because it has only a single <a class="el" href="structCC__Mqtt5UnsubscribeTopicConfig.html#abc1e6a2792caa6c217d92ef975eb0d49">CC_Mqtt5UnsubscribeTopicConfig::m_topic</a> member, which is going to be overwritten as part of the configuration. However, calling the <b><a class="el" href="group__unsubscribe.html#gaafb93baecc28842fe05b502beed046bc" title="Intialize the CC_Mqtt5UnsubscribeTopicConfig configuration structure.">cc_mqtt5_client_unsubscribe_init_config_topic()</a></b> is still recommended to make the application's code future updates proof. Potentially the MQTT5 specification and as the result this library can be updated by adding new fields to the <a class="el" href="structCC__Mqtt5UnsubscribeTopicConfig.html">CC_Mqtt5UnsubscribeTopicConfig</a> struct. Having the "unnecessary" call to the <b><a class="el" href="group__unsubscribe.html#gaafb93baecc28842fe05b502beed046bc" title="Intialize the CC_Mqtt5UnsubscribeTopicConfig configuration structure.">cc_mqtt5_client_unsubscribe_init_config_topic()</a></b> function makes sure that newly added field gets initialized to the default value without any need to update the application's code.</p>
<p>By default the library will perform the analysis of the submitted topic format and reject it if topic format is incorrect. However, for performance reasons it is possible to disable such verification when client application ensures that no invalid topics are used. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__client.html#gacbfe7d85c9f3c373bdf7bb5473616b35">cc_mqtt5_client_set_verify_outgoing_topic_enabled</a>(client, <span class="keyword">false</span>);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    ... <span class="comment">/* Something is wrong */</span></div>
<div class="line">}</div>
</div><!-- fragment --><p> <b>NOTE</b> that the configuration is global per client and not per "unsubscribe" operation.</p>
<p>Also <b>note</b> that the same function controls the verification of the "subscribe", "unsubscribe" and "publish" topic formats.</p>
<p>To retrieve the current configuration use <b><a class="el" href="group__client.html#ga58897f8539e72671602cc3fc8e9ac19f" title="Retrieve current outgoing topic format verification control.">cc_mqtt5_client_get_verify_outgoing_topic_enabled()</a></b> function.</p>
<h2><a class="anchor" id="cc_mqtt5_client_unsubscribe_user_prop"></a>
Adding "User Properties"</h2>
<p>The MQTT5 specification allows attaching any number of the "User Properties" to the <b>UNSUBSCRIBE</b> message. The library allows such assignment using multiple invocations of the <b><a class="el" href="group__unsubscribe.html#gae3cf4043b8340930b998d6ed1c12ea42" title="Add user property to the configuration of the &quot;unsubscribe&quot; operation.">cc_mqtt5_client_unsubscribe_add_user_prop()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> prop;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#af0ad9b0d643a2e9222f7810c586f9c08">m_key</a> = <span class="stringliteral">&quot;some_key&quot;</span>;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#a63bde874936587bd145b6209164a6969">m_value</a> = <span class="stringliteral">&quot;some_value&quot;</span>;</div>
<div class="line">ec = <a class="code" href="group__unsubscribe.html#gae3cf4043b8340930b998d6ed1c12ea42">cc_mqtt5_client_unsubscribe_add_user_prop</a>(unsubscribe, &amp;prop);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: User property configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__unsubscribe_html_gae3cf4043b8340930b998d6ed1c12ea42"><div class="ttname"><a href="group__unsubscribe.html#gae3cf4043b8340930b998d6ed1c12ea42">cc_mqtt5_client_unsubscribe_add_user_prop</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_unsubscribe_add_user_prop(CC_Mqtt5UnsubscribeHandle handle, const CC_Mqtt5UserProp *prop)</div><div class="ttdoc">Add user property to the configuration of the &quot;unsubscribe&quot; operation.</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> structure.</p>
<h2><a class="anchor" id="cc_mqtt5_client_unsubscribe_send"></a>
Sending Unsubscription Request</h2>
<p>When all the necessary configurations are performed for the allocated "unsubscribe" operation it can actually be sent to the broker. To initiate sending use the <b><a class="el" href="group__unsubscribe.html#ga5c19d2c577daed73b9b8a5e6797f2234" title="Send the configured &quot;unsubscribe&quot; operation to broker.">cc_mqtt5_client_unsubscribe_send()</a></b> function. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> my_unsubscribe_complete_cb(<span class="keywordtype">void</span>* data, <a class="code" href="group__unsubscribe.html#ga7ab1c795bfe02334906f1ecc0be921e5">CC_Mqtt5UnsubscribeHandle</a> handle, <a class="code" href="group__global.html#gabd56266bda747f19e4c6669fa0da021d">CC_Mqtt5AsyncOpStatus</a> status, <span class="keyword">const</span> <a class="code" href="structCC__Mqtt5UnsubscribeResponse.html">CC_Mqtt5UnsubscribeResponse</a>* response)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;ERROR: The unsubscription operation has failed with status=%d\n&quot;</span>, status);</div>
<div class="line">        ... <span class="comment">// handle error.</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// &quot;response&quot; is not NULL when status is CC_Mqtt5AsyncOpStatus_Complete.</span></div>
<div class="line">    assert(response != NULL);</div>
<div class="line">    ... <span class="comment">// Analyze response values.</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">ec = <a class="code" href="group__unsubscribe.html#ga5c19d2c577daed73b9b8a5e6797f2234">cc_mqtt5_client_unsubscribe_send</a>(unsubscribe, &amp;my_unsubscribe_complete_cb, data);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to send unsubscribe request with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__unsubscribe_html_ga5c19d2c577daed73b9b8a5e6797f2234"><div class="ttname"><a href="group__unsubscribe.html#ga5c19d2c577daed73b9b8a5e6797f2234">cc_mqtt5_client_unsubscribe_send</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_unsubscribe_send(CC_Mqtt5UnsubscribeHandle handle, CC_Mqtt5UnsubscribeCompleteCb cb, void *cbData)</div><div class="ttdoc">Send the configured &quot;unsubscribe&quot; operation to broker.</div></div>
<div class="ttc" id="astructCC__Mqtt5UnsubscribeResponse_html"><div class="ttname"><a href="structCC__Mqtt5UnsubscribeResponse.html">CC_Mqtt5UnsubscribeResponse</a></div><div class="ttdoc">Response information from broker to &quot;unsubscribe&quot; request.</div><div class="ttdef"><b>Definition:</b> common.h:406</div></div>
</div><!-- fragment --><p> The provided callback will be invoked when the "unsubscribe" operation is complete <b> if and only if</b> the function returns <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>.</p>
<p>The handle returned by the <b><a class="el" href="group__unsubscribe.html#ga902e65feaa5337fd659a9851569397ec" title="Prepare &quot;unsubscribe&quot; operation.">cc_mqtt5_client_unsubscribe_prepare()</a></b> function can be discarded (there is no free / de-allocation) right after the <b><a class="el" href="group__unsubscribe.html#ga5c19d2c577daed73b9b8a5e6797f2234" title="Send the configured &quot;unsubscribe&quot; operation to broker.">cc_mqtt5_client_unsubscribe_send()</a></b> invocation regardless of the returned error code. However, the handle remains valid until the callback is called (in case the <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a> was returned). The valid handle can be used to <a class="el" href="index.html#cc_mqtt5_client_unsubscribe_cancel">cancel</a> the operation before the completion callback is invoked.</p>
<p>Note that the callback function receives the "unsubscribe" operation handle as its second parameter. Although the handle is already invalid and cannot be used in any other function, it allows the application to identify the original "unsubscribe" request if multiple have been issued in parallel and use the same callback function for all of them.</p>
<p>When the "unsubscribe" operation completion callback is invoked the reported "response" information is present <b>if and only if</b> the "status" is <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a>.</p>
<h2><a class="anchor" id="cc_mqtt5_client_unsubscribe_cancel"></a>
Cancel the "Unsubscribe" Operation.</h2>
<p>While the handle returned by the <b><a class="el" href="group__unsubscribe.html#ga902e65feaa5337fd659a9851569397ec" title="Prepare &quot;unsubscribe&quot; operation.">cc_mqtt5_client_unsubscribe_prepare()</a></b> is still valid it is possible to cancel / discard the operation. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__unsubscribe.html#ga9e2455b5cf5eca6dea477247c4bc2572">cc_mqtt5_client_unsubscribe_cancel</a>(unsubscribe);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to cancel unsubscribe with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__unsubscribe_html_ga9e2455b5cf5eca6dea477247c4bc2572"><div class="ttname"><a href="group__unsubscribe.html#ga9e2455b5cf5eca6dea477247c4bc2572">cc_mqtt5_client_unsubscribe_cancel</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_unsubscribe_cancel(CC_Mqtt5UnsubscribeHandle handle)</div><div class="ttdoc">Cancel the allocated &quot;unsubscribe&quot; operation.</div></div>
</div><!-- fragment --><p> In case the <b><a class="el" href="group__unsubscribe.html#ga5c19d2c577daed73b9b8a5e6797f2234" title="Send the configured &quot;unsubscribe&quot; operation to broker.">cc_mqtt5_client_unsubscribe_send()</a></b> function was successfully called before the <b><a class="el" href="group__unsubscribe.html#ga9e2455b5cf5eca6dea477247c4bc2572" title="Cancel the allocated &quot;unsubscribe&quot; operation.">cc_mqtt5_client_unsubscribe_cancel()</a></b>, the operation is cancelled <b>without</b> callback invocation.</p>
<h1><a class="anchor" id="cc_mqtt5_client_publish"></a>
Publishing Messages</h1>
<p>To publish messages to the broker use <a class="el" href="group__publish.html">publish</a> operation.</p>
<h2><a class="anchor" id="cc_mqtt5_client_publish_prepare"></a>
Preparing "Publish" Operation.</h2>
<div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>;</div>
<div class="line"><a class="code" href="group__publish.html#ga14db4a399e646903cbe72691616ef9c4">CC_Mqtt5PublishHandle</a> publish = <a class="code" href="group__publish.html#ga8ba52035a9ea815cbc65592d93bfc1cf">cc_mqtt5_client_publish_prepare</a>(client, &amp;ec);</div>
<div class="line"><span class="keywordflow">if</span> (publish == NULL) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Publish allocation failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__publish_html_ga14db4a399e646903cbe72691616ef9c4"><div class="ttname"><a href="group__publish.html#ga14db4a399e646903cbe72691616ef9c4">CC_Mqtt5PublishHandle</a></div><div class="ttdeci">CC_Mqtt5Publish * CC_Mqtt5PublishHandle</div><div class="ttdoc">Handle for &quot;publish&quot; operation.</div><div class="ttdef"><b>Definition:</b> common.h:237</div></div>
<div class="ttc" id="agroup__publish_html_ga8ba52035a9ea815cbc65592d93bfc1cf"><div class="ttname"><a href="group__publish.html#ga8ba52035a9ea815cbc65592d93bfc1cf">cc_mqtt5_client_publish_prepare</a></div><div class="ttdeci">CC_Mqtt5PublishHandle cc_mqtt5_client_publish_prepare(CC_Mqtt5ClientHandle handle, CC_Mqtt5ErrorCode *ec)</div><div class="ttdoc">Prepare &quot;publish&quot; operation.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="cc_mqtt5_client_publish_response_timeout"></a>
Configuring "Publish" Response Timeout</h2>
<p>When publishing messages with QoS value <a class="el" href="group__global.html#ggacfea3a318c3e2dd3d60c69a6a6157d7fa7177e192e6dd58b2eae3b78eb671eec5">CC_Mqtt5QoS_AtLeastOnceDelivery</a> or above, the response from the broker is expected.</p>
<p>When created, the "publish" operation inherits the <a class="el" href="index.html#cc_mqtt5_client_response_timeout">Default Response Timeout</a> configuration. It can be changed for the allocated operation using the <b><a class="el" href="group__publish.html#ga8d1bfed81a79f8460f6cc679bdd157cd" title="Configure the broker response timeout for the &quot;publish&quot; operation.">cc_mqtt5_client_publish_set_response_timeout()</a></b> function. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__publish.html#ga8d1bfed81a79f8460f6cc679bdd157cd">cc_mqtt5_client_publish_set_response_timeout</a>(publish, 1000);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    ... <span class="comment">/* Something went wrong */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__publish_html_ga8d1bfed81a79f8460f6cc679bdd157cd"><div class="ttname"><a href="group__publish.html#ga8d1bfed81a79f8460f6cc679bdd157cd">cc_mqtt5_client_publish_set_response_timeout</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_publish_set_response_timeout(CC_Mqtt5PublishHandle handle, unsigned ms)</div><div class="ttdoc">Configure the broker response timeout for the &quot;publish&quot; operation.</div></div>
</div><!-- fragment --><p> To retrieve the configured response timeout use the <b><a class="el" href="group__publish.html#ga27189d64a90fa6c190848467a5237023" title="Retrieve the configured the broker response timeout for the &quot;publish&quot; operation.">cc_mqtt5_client_publish_get_response_timeout()</a></b> function.</p>
<h2><a class="anchor" id="cc_mqtt5_client_publish_resend"></a>
Configuring "Publish" Re-Send Attempts</h2>
<p>The MQTT5 specification has a mechanism of insured delivery of the published message to the broker. In the case of not 100% reliable connection the messages can get lost and needs to be re-sent. The default amount of re-sends is <b>2</b>, i.e. when the first send is not acknowledged by the broker, it is tried again with <b>DUP</b> flag is set in the <b>PUBLISH</b> message. When the second attempt is not acknowledged, then the publish operation is terminated with appropriate status report. It is possible to change the default by using <b><a class="el" href="group__publish.html#gae8e04a144f923f3e5829c3522b1f22ba" title="Configure the amount of attempts to resend &quot;publish&quot; operation until the acknowledgement is received.">cc_mqtt5_client_publish_set_resend_attempts()</a></b> function. The <b>DUP</b> flag will be sent for all the re-sent <b>PUBLISH</b> messages. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__publish.html#gae8e04a144f923f3e5829c3522b1f22ba">cc_mqtt5_client_publish_set_resend_attempts</a>(publish, 3);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    ... <span class="comment">/* Something went wrong */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__publish_html_gae8e04a144f923f3e5829c3522b1f22ba"><div class="ttname"><a href="group__publish.html#gae8e04a144f923f3e5829c3522b1f22ba">cc_mqtt5_client_publish_set_resend_attempts</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_publish_set_resend_attempts(CC_Mqtt5PublishHandle handle, unsigned attempts)</div><div class="ttdoc">Configure the amount of attempts to resend &quot;publish&quot; operation until the acknowledgement is received.</div></div>
</div><!-- fragment --><p> To retrieve the configured resend attempts number use the <b><a class="el" href="group__publish.html#gac4cd4b0346ab8c622bc962b1a2f6386e" title="Retrieve the configured the amount of resend attempts for the &quot;publish&quot; operation.">cc_mqtt5_client_publish_get_resend_attempts()</a></b> function.</p>
<h2><a class="anchor" id="cc_mqtt5_client_publish_basic"></a>
Basic Configuration of "Publish" Operation</h2>
<p>The "basic" configuration means no extra MQTT5 properties assigned to the message, with one small exception of using topic alias (covered <a class="el" href="index.html#cc_mqtt5_client_publish_alias">below</a> as a separate subject). </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5PublishBasicConfig.html">CC_Mqtt5PublishBasicConfig</a> basicConfig;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign default values to the &quot;basicConfig&quot;</span></div>
<div class="line"><a class="code" href="group__publish.html#gaa2dd7ba8568d1cc308c366923f15c06c">cc_mqtt5_client_publish_init_config_basic</a>(&amp;basicConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Update the required values</span></div>
<div class="line">basicConfig.<a class="code" href="structCC__Mqtt5PublishBasicConfig.html#ae7bc1adf629616ec12b04de07f001dbc">m_topic</a> = <span class="stringliteral">&quot;some_topic&quot;</span>;</div>
<div class="line">basicConfig.<a class="code" href="structCC__Mqtt5PublishBasicConfig.html#a4fc02acb8709c31e4795de2c3d2393cf">m_data</a> = &amp;some_buf[0];</div>
<div class="line">basicConfig.<a class="code" href="structCC__Mqtt5PublishBasicConfig.html#ae0ce7a1f341be35bd3b6f46f1fe6a0f4">m_dataLen</a> = ...;</div>
<div class="line">basicConfig.<a class="code" href="structCC__Mqtt5PublishBasicConfig.html#a5c41de3a1d8f01266179291f597a1ee9">m_qos</a> = ...;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the configuration</span></div>
<div class="line">ec = <a class="code" href="group__publish.html#ga26d76d06ea71b80772de903d0418ec15">cc_mqtt5_client_publish_config_basic</a>(publish, &amp;basicConfig);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Basic configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__publish_html_ga26d76d06ea71b80772de903d0418ec15"><div class="ttname"><a href="group__publish.html#ga26d76d06ea71b80772de903d0418ec15">cc_mqtt5_client_publish_config_basic</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_publish_config_basic(CC_Mqtt5PublishHandle handle, const CC_Mqtt5PublishBasicConfig *config)</div><div class="ttdoc">Perform basic configuration of the &quot;publish&quot; operation.</div></div>
<div class="ttc" id="agroup__publish_html_gaa2dd7ba8568d1cc308c366923f15c06c"><div class="ttname"><a href="group__publish.html#gaa2dd7ba8568d1cc308c366923f15c06c">cc_mqtt5_client_publish_init_config_basic</a></div><div class="ttdeci">void cc_mqtt5_client_publish_init_config_basic(CC_Mqtt5PublishBasicConfig *config)</div><div class="ttdoc">Intialize the CC_Mqtt5PublishBasicConfig configuration structure.</div></div>
<div class="ttc" id="astructCC__Mqtt5PublishBasicConfig_html"><div class="ttname"><a href="structCC__Mqtt5PublishBasicConfig.html">CC_Mqtt5PublishBasicConfig</a></div><div class="ttdoc">Configuration structure to be passed to the cc_mqtt5_client_publish_config_basic().</div><div class="ttdef"><b>Definition:</b> common.h:439</div></div>
<div class="ttc" id="astructCC__Mqtt5PublishBasicConfig_html_a4fc02acb8709c31e4795de2c3d2393cf"><div class="ttname"><a href="structCC__Mqtt5PublishBasicConfig.html#a4fc02acb8709c31e4795de2c3d2393cf">CC_Mqtt5PublishBasicConfig::m_data</a></div><div class="ttdeci">const unsigned char * m_data</div><div class="ttdoc">Pointer to publish data buffer, defaults to NULL.</div><div class="ttdef"><b>Definition:</b> common.h:441</div></div>
<div class="ttc" id="astructCC__Mqtt5PublishBasicConfig_html_a5c41de3a1d8f01266179291f597a1ee9"><div class="ttname"><a href="structCC__Mqtt5PublishBasicConfig.html#a5c41de3a1d8f01266179291f597a1ee9">CC_Mqtt5PublishBasicConfig::m_qos</a></div><div class="ttdeci">CC_Mqtt5QoS m_qos</div><div class="ttdoc">Publish QoS value, defaults to CC_Mqtt5QoS_AtMostOnceDelivery.</div><div class="ttdef"><b>Definition:</b> common.h:443</div></div>
<div class="ttc" id="astructCC__Mqtt5PublishBasicConfig_html_ae0ce7a1f341be35bd3b6f46f1fe6a0f4"><div class="ttname"><a href="structCC__Mqtt5PublishBasicConfig.html#ae0ce7a1f341be35bd3b6f46f1fe6a0f4">CC_Mqtt5PublishBasicConfig::m_dataLen</a></div><div class="ttdeci">unsigned m_dataLen</div><div class="ttdoc">Amount of bytes in the publish data buffer, defaults to 0.</div><div class="ttdef"><b>Definition:</b> common.h:442</div></div>
<div class="ttc" id="astructCC__Mqtt5PublishBasicConfig_html_ae7bc1adf629616ec12b04de07f001dbc"><div class="ttname"><a href="structCC__Mqtt5PublishBasicConfig.html#ae7bc1adf629616ec12b04de07f001dbc">CC_Mqtt5PublishBasicConfig::m_topic</a></div><div class="ttdeci">const char * m_topic</div><div class="ttdoc">Publish topic, cannot be NULL.</div><div class="ttdef"><b>Definition:</b> common.h:440</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5PublishBasicConfig.html">CC_Mqtt5PublishBasicConfig</a> structure.</p>
<p>By default the library will perform the analysis of the submitted topic format and reject it if topic format is incorrect. However, for performance reasons it is possible to disable such verification when client application ensures that no invalid topics are used. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__client.html#gacbfe7d85c9f3c373bdf7bb5473616b35">cc_mqtt5_client_set_verify_outgoing_topic_enabled</a>(client, <span class="keyword">false</span>);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    ... <span class="comment">/* Something is wrong */</span></div>
<div class="line">}</div>
</div><!-- fragment --><p> To retrieve the current configuration use the <b><a class="el" href="group__client.html#ga58897f8539e72671602cc3fc8e9ac19f" title="Retrieve current outgoing topic format verification control.">cc_mqtt5_client_get_verify_outgoing_topic_enabled()</a></b> function.</p>
<p><b>NOTE</b> that the configuration is global per client and not per "publish" operation.</p>
<p>Also <b>note</b> that the same function controls the verification of the "subscribe", "unsubscribe", and "publish" filter / topic formats.</p>
<h2><a class="anchor" id="cc_mqtt5_client_publish_extra"></a>
Extra Properties Configuration</h2>
<p>To add extra MQTT5 specific properties to the publish request use <b><a class="el" href="group__publish.html#gaae32b8550c3448c54d7fb373ba2214ac" title="Perform extra properties configuration of the &quot;publish&quot; operation.">cc_mqtt5_client_publish_config_extra()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5PublishExtraConfig.html">CC_Mqtt5PublishExtraConfig</a> extraConfig;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the configuration structure to the default values</span></div>
<div class="line"><a class="code" href="group__publish.html#ga3364b7d98f39c4c17a88e9f74d76326d">cc_mqtt5_client_publish_init_config_extra</a>(&amp;extraConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign necessary properties:</span></div>
<div class="line">extraConfig.<a class="code" href="structCC__Mqtt5PublishExtraConfig.html#a40c317b865ba5287b2ac99da06eeb414">m_messageExpiryInterval</a> = 5;</div>
<div class="line">extraConfig.<a class="code" href="structCC__Mqtt5PublishExtraConfig.html#ae514543e4059541eeaa0307bcbcc1f5d">m_format</a> = <a class="code" href="group__global.html#gga15e5d0f870e3f2afaeb44f5122e640d7ab9b4ffcbaf6e8dbed9d9f40af06e9fe1">CC_Mqtt5PayloadFormat_Utf8</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the configuration</span></div>
<div class="line">ec = <a class="code" href="group__publish.html#gaae32b8550c3448c54d7fb373ba2214ac">cc_mqtt5_client_publish_config_extra</a>(publish, &amp;extraConfig);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Extra properties configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__global_html_gga15e5d0f870e3f2afaeb44f5122e640d7ab9b4ffcbaf6e8dbed9d9f40af06e9fe1"><div class="ttname"><a href="group__global.html#gga15e5d0f870e3f2afaeb44f5122e640d7ab9b4ffcbaf6e8dbed9d9f40af06e9fe1">CC_Mqtt5PayloadFormat_Utf8</a></div><div class="ttdeci">@ CC_Mqtt5PayloadFormat_Utf8</div><div class="ttdoc">UTF-8 string.</div><div class="ttdef"><b>Definition:</b> common.h:89</div></div>
<div class="ttc" id="agroup__publish_html_ga3364b7d98f39c4c17a88e9f74d76326d"><div class="ttname"><a href="group__publish.html#ga3364b7d98f39c4c17a88e9f74d76326d">cc_mqtt5_client_publish_init_config_extra</a></div><div class="ttdeci">void cc_mqtt5_client_publish_init_config_extra(CC_Mqtt5PublishExtraConfig *config)</div><div class="ttdoc">Intialize the CC_Mqtt5PublishExtraConfig configuration structure.</div></div>
<div class="ttc" id="agroup__publish_html_gaae32b8550c3448c54d7fb373ba2214ac"><div class="ttname"><a href="group__publish.html#gaae32b8550c3448c54d7fb373ba2214ac">cc_mqtt5_client_publish_config_extra</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_publish_config_extra(CC_Mqtt5PublishHandle handle, const CC_Mqtt5PublishExtraConfig *config)</div><div class="ttdoc">Perform extra properties configuration of the &quot;publish&quot; operation.</div></div>
<div class="ttc" id="astructCC__Mqtt5PublishExtraConfig_html"><div class="ttname"><a href="structCC__Mqtt5PublishExtraConfig.html">CC_Mqtt5PublishExtraConfig</a></div><div class="ttdoc">Configuration structure to be passed to the cc_mqtt5_client_publish_config_extra().</div><div class="ttdef"><b>Definition:</b> common.h:452</div></div>
<div class="ttc" id="astructCC__Mqtt5PublishExtraConfig_html_a40c317b865ba5287b2ac99da06eeb414"><div class="ttname"><a href="structCC__Mqtt5PublishExtraConfig.html#a40c317b865ba5287b2ac99da06eeb414">CC_Mqtt5PublishExtraConfig::m_messageExpiryInterval</a></div><div class="ttdeci">unsigned m_messageExpiryInterval</div><div class="ttdoc">&quot;Message Expiry Interval&quot; property, defaults to 0, not added when 0.</div><div class="ttdef"><b>Definition:</b> common.h:457</div></div>
<div class="ttc" id="astructCC__Mqtt5PublishExtraConfig_html_ae514543e4059541eeaa0307bcbcc1f5d"><div class="ttname"><a href="structCC__Mqtt5PublishExtraConfig.html#ae514543e4059541eeaa0307bcbcc1f5d">CC_Mqtt5PublishExtraConfig::m_format</a></div><div class="ttdeci">CC_Mqtt5PayloadFormat m_format</div><div class="ttdoc">&quot;Payload Format Indicator&quot; property, defaults to CC_Mqtt5PayloadFormat_Unspecified,...</div><div class="ttdef"><b>Definition:</b> common.h:458</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5PublishExtraConfig.html">CC_Mqtt5PublishExtraConfig</a> structure.</p>
<h2><a class="anchor" id="cc_mqtt5_client_publish_user_prop"></a>
Adding "User Properties"</h2>
<p>The MQTT5 specification allows attaching any number of the "User Properties" to the <b>PUBLISH</b> message. The library allows such assignment using multiple invocations of the <b><a class="el" href="group__publish.html#ga9fe48afc42867e3eb9cbfcf26d0e71da" title="Add user property to the configuration of the &quot;publish&quot; operation.">cc_mqtt5_client_publish_add_user_prop()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> prop;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#af0ad9b0d643a2e9222f7810c586f9c08">m_key</a> = <span class="stringliteral">&quot;some_key&quot;</span>;</div>
<div class="line">prop.<a class="code" href="structCC__Mqtt5UserProp.html#a63bde874936587bd145b6209164a6969">m_value</a> = <span class="stringliteral">&quot;some_value&quot;</span>;</div>
<div class="line">ec = <a class="code" href="group__publish.html#ga9fe48afc42867e3eb9cbfcf26d0e71da">cc_mqtt5_client_publish_add_user_prop</a>(publish, &amp;prop);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: User property configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__publish_html_ga9fe48afc42867e3eb9cbfcf26d0e71da"><div class="ttname"><a href="group__publish.html#ga9fe48afc42867e3eb9cbfcf26d0e71da">cc_mqtt5_client_publish_add_user_prop</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_publish_add_user_prop(CC_Mqtt5PublishHandle handle, const CC_Mqtt5UserProp *prop)</div><div class="ttdoc">Add user property to the configuration of the &quot;publish&quot; operation.</div></div>
</div><!-- fragment --><p> See also documentation of the <a class="el" href="structCC__Mqtt5UserProp.html">CC_Mqtt5UserProp</a> structure.</p>
<h2><a class="anchor" id="cc_mqtt5_client_publish_send"></a>
Sending Publish Request</h2>
<p>When all the necessary configurations are performed for the allocated "publish" operation it can actually be sent to the broker. To initiate sending use the <b><a class="el" href="group__publish.html#gaf19c2d2953ee67a413877681fcf8fcc9" title="Send the configured &quot;publish&quot; operation to broker.">cc_mqtt5_client_publish_send()</a></b> function. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> my_publish_complete_cb(<span class="keywordtype">void</span>* data, <a class="code" href="group__publish.html#ga14db4a399e646903cbe72691616ef9c4">CC_Mqtt5PublishHandle</a> handle, <a class="code" href="group__global.html#gabd56266bda747f19e4c6669fa0da021d">CC_Mqtt5AsyncOpStatus</a> status, <span class="keyword">const</span> <a class="code" href="structCC__Mqtt5PublishResponse.html">CC_Mqtt5PublishResponse</a>* response)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;ERROR: The publish operation has failed with status=%d\n&quot;</span>, status);</div>
<div class="line">        ... <span class="comment">// handle error.</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// &quot;response&quot; may be NULL when there is no response from broker</span></div>
<div class="line">    <span class="comment">// applicable when QoS is CC_Mqtt5QoS_AtMostOnceDelivery.</span></div>
<div class="line">    <span class="keywordflow">if</span> (response == NULL) {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    ... <span class="comment">// Analyze response values.</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">ec = <a class="code" href="group__publish.html#gaf19c2d2953ee67a413877681fcf8fcc9">cc_mqtt5_client_publish_send</a>(publish, &amp;my_publish_complete_cb, data);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to send publish request with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__publish_html_gaf19c2d2953ee67a413877681fcf8fcc9"><div class="ttname"><a href="group__publish.html#gaf19c2d2953ee67a413877681fcf8fcc9">cc_mqtt5_client_publish_send</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_publish_send(CC_Mqtt5PublishHandle handle, CC_Mqtt5PublishCompleteCb cb, void *cbData)</div><div class="ttdoc">Send the configured &quot;publish&quot; operation to broker.</div></div>
<div class="ttc" id="astructCC__Mqtt5PublishResponse_html"><div class="ttname"><a href="structCC__Mqtt5PublishResponse.html">CC_Mqtt5PublishResponse</a></div><div class="ttdoc">Response information from broker to &quot;publish&quot; request.</div><div class="ttdef"><b>Definition:</b> common.h:464</div></div>
</div><!-- fragment --><p> The provided callback will be invoked when the "publish" operation is complete <b> if and only if</b> the function returns <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>.</p>
<p>The callback pointer can also be <b>NULL</b>. In such case the completion of the publish operation is silent.</p>
<p>When QoS value is <a class="el" href="group__global.html#ggacfea3a318c3e2dd3d60c69a6a6157d7fa371c4d68d2d2c2ce9bd07927b22596fb">CC_Mqtt5QoS_AtMostOnceDelivery</a> (see the <a class="el" href="index.html#cc_mqtt5_client_publish_basic">basic</a> configuration), there is no broker response to wait for and the callback is invoked right away after sending the serialized data.</p>
<p>The handle returned by the <b><a class="el" href="group__publish.html#ga8ba52035a9ea815cbc65592d93bfc1cf" title="Prepare &quot;publish&quot; operation.">cc_mqtt5_client_publish_prepare()</a></b> function can be discarded (there is no free / de-allocation) right after the <b><a class="el" href="group__publish.html#gaf19c2d2953ee67a413877681fcf8fcc9" title="Send the configured &quot;publish&quot; operation to broker.">cc_mqtt5_client_publish_send()</a></b> invocation regardless of the returned error code. However, the handle remains valid until the callback is called (in case the <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a> was returned). The valid handle can be used to <a class="el" href="index.html#cc_mqtt5_client_publish_cancel">cancel</a> the operation before the completion callback is invoked.</p>
<p>Note that the callback function receives the "publish" operation handle as its second parameter. Although the handle is already invalid and cannot be used in any other function, it allows the application to identify the original "publish" request if multiple have been issued in parallel and use the same callback function for all of them.</p>
<p>When the "publish" operation completion callback is invoked the reported "response" information is present <b>if and only if</b> the "status" is <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a> and the publish QoS was 1 (<a class="el" href="group__global.html#ggacfea3a318c3e2dd3d60c69a6a6157d7fa7177e192e6dd58b2eae3b78eb671eec5">CC_Mqtt5QoS_AtLeastOnceDelivery</a>) or higher.</p>
<p>When the callback reporting the publish status is invoked, it is responsibility of the application to check the <a class="el" href="structCC__Mqtt5PublishResponse.html#aedaed87fe14c82e6dd9823348defcede">CC_Mqtt5PublishResponse::m_reasonCode</a> value. If it's <a class="el" href="group__global.html#gga7231ab939f4dd41f18a27ed953fda977af6b53fd67e10ddb82f83106298405dfe">CC_Mqtt5ReasonCode_UnspecifiedError</a> or greater means the "publish" operation wasn't successful.</p>
<h2><a class="anchor" id="cc_mqtt5_client_publish_cancel"></a>
Cancel the "Publish" Operation.</h2>
<p>While the handle returned by the <b><a class="el" href="group__publish.html#ga8ba52035a9ea815cbc65592d93bfc1cf" title="Prepare &quot;publish&quot; operation.">cc_mqtt5_client_publish_prepare()</a></b> is still valid it is possible to cancel / discard the operation. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__publish.html#gad3e4a970267a4634242cda4655b86ddc">cc_mqtt5_client_publish_cancel</a>(publish);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to cancel publish with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__publish_html_gad3e4a970267a4634242cda4655b86ddc"><div class="ttname"><a href="group__publish.html#gad3e4a970267a4634242cda4655b86ddc">cc_mqtt5_client_publish_cancel</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_publish_cancel(CC_Mqtt5PublishHandle handle)</div><div class="ttdoc">Cancel the allocated &quot;publish&quot; operation.</div></div>
</div><!-- fragment --><p> In case the <b><a class="el" href="group__publish.html#gaf19c2d2953ee67a413877681fcf8fcc9" title="Send the configured &quot;publish&quot; operation to broker.">cc_mqtt5_client_publish_send()</a></b> function was successfully called before the <b><a class="el" href="group__publish.html#gad3e4a970267a4634242cda4655b86ddc" title="Cancel the allocated &quot;publish&quot; operation.">cc_mqtt5_client_publish_cancel()</a></b>, the operation is cancelled <b>without</b> callback invocation.</p>
<h2><a class="anchor" id="cc_mqtt5_client_publish_alias"></a>
Using Topic Alias</h2>
<p>The MQTT5 specification allows usage of the numeric topic aliases to be able to reduce amount of bytes per publish. In order for the library to start using topic aliases, they need to be allocated (registered) using the <b><a class="el" href="group__client.html#ga4c2fe1f32a4c01246cf180a42689a4b3" title="Allocate alias for topic.">cc_mqtt5_client_pub_topic_alias_alloc()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__client.html#ga4c2fe1f32a4c01246cf180a42689a4b3">cc_mqtt5_client_pub_topic_alias_alloc</a>(client, <span class="stringliteral">&quot;some_topic&quot;</span>, 2 <span class="comment">/* qos0RegsCount */</span>);</div>
<div class="ttc" id="agroup__client_html_ga4c2fe1f32a4c01246cf180a42689a4b3"><div class="ttname"><a href="group__client.html#ga4c2fe1f32a4c01246cf180a42689a4b3">cc_mqtt5_client_pub_topic_alias_alloc</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_pub_topic_alias_alloc(CC_Mqtt5ClientHandle handle, const char *topic, unsigned qos0RegsCount)</div><div class="ttdoc">Allocate alias for topic.</div></div>
</div><!-- fragment --><p> Note that the broker reports maximum amount of allowed topic aliases in its response to the "connect" request via the <a class="el" href="structCC__Mqtt5ConnectResponse.html#a9d5ae2c29e4c6dda24a28aef745091e3">CC_Mqtt5ConnectResponse::m_topicAliasMax</a> ("Topic Alias Maximum" property). It means that the allocation of the topic aliases is allowed only after the successful "connect" operation.</p>
<p>Also note that the topic aliases are not part of the session state. Every <a class="el" href="index.html#cc_mqtt5_client_init">re-initialization</a> (which is required for <a class="el" href="index.html#cc_mqtt5_client_connect">re-connection</a>) all the previously allocated topic aliases get cleared in the internal data structures and they need to be allocated again.</p>
<p>The last parameter passed to the <b><a class="el" href="group__client.html#ga4c2fe1f32a4c01246cf180a42689a4b3" title="Allocate alias for topic.">cc_mqtt5_client_pub_topic_alias_alloc()</a></b> function is used to specify how many times the topic alias is reported to the broker alongside the topic string in the "publish" operation when only QoS0 publishes are used. For the QoS1 and QoS2 "publish" operations there is an acknowledgement message from the broker indicating that the topic alias is received and known to the broker. However, when QoS0 only publishes are performed, the reception of the topic alias registration request by the broker is not ensured. Also the MQTT5 specification explicitly states that it is "Protocol Error" to use unknown topic alias. </p><div class="fragment"><div class="line">If the PUBLISH packet contains a Topic Alias, the receiver processes it as follows:</div>
<div class="line">...</div>
<div class="line">3) If the receiver does not already have a mapping for this Topic Alias</div>
<div class="line">    a) If the packet has a zero length Topic Name field it is a Protocol Error and the receiver uses</div>
<div class="line">       DISCONNECT with Reason Code of 0x82 (Protocol Error) as described in section 4.13.</div>
</div><!-- fragment --><p> Based on the said above, it can be prone to unexpected protocol error disconnection to use single QoS0 publish message to report topic alias to the broker, so the last parameter of the <b><a class="el" href="group__client.html#ga4c2fe1f32a4c01246cf180a42689a4b3" title="Allocate alias for topic.">cc_mqtt5_client_pub_topic_alias_alloc()</a></b> function indicates how many times the topic alias needs to be reported to the broker alongside the topic string itself before client is allowed to send topic alias only without the topic string. However if any QoS1 or QoS2 messages are successfully published to the broker with the same topic alias, then all the subsequent QoS0 message will use topic alias without the topic string.</p>
<p>To stop using topic alias for the specific topic, use <b><a class="el" href="group__client.html#ga3123c250a99ea1103c1bcd4fe3d8d6a2" title="Free alias for topic for another use.">cc_mqtt5_client_pub_topic_alias_free()</a></b> function to free the allocated alias. </p><div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__client.html#ga3123c250a99ea1103c1bcd4fe3d8d6a2">cc_mqtt5_client_pub_topic_alias_free</a>(client, <span class="stringliteral">&quot;some_topic&quot;</span>);</div>
<div class="ttc" id="agroup__client_html_ga3123c250a99ea1103c1bcd4fe3d8d6a2"><div class="ttname"><a href="group__client.html#ga3123c250a99ea1103c1bcd4fe3d8d6a2">cc_mqtt5_client_pub_topic_alias_free</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_pub_topic_alias_free(CC_Mqtt5ClientHandle handle, const char *topic)</div><div class="ttdoc">Free alias for topic for another use.</div></div>
</div><!-- fragment --><p>To inquire how many topic aliases have already been allocated, use the <b><a class="el" href="group__client.html#ga3854000b63deee7d20b3e6e2297d2ed1" title="Get amount of allocated topic aliases.">cc_mqtt5_client_pub_topic_alias_count()</a></b> function. </p><div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> count = <a class="code" href="group__client.html#ga3854000b63deee7d20b3e6e2297d2ed1">cc_mqtt5_client_pub_topic_alias_count</a>(client);</div>
<div class="ttc" id="agroup__client_html_ga3854000b63deee7d20b3e6e2297d2ed1"><div class="ttname"><a href="group__client.html#ga3854000b63deee7d20b3e6e2297d2ed1">cc_mqtt5_client_pub_topic_alias_count</a></div><div class="ttdeci">unsigned cc_mqtt5_client_pub_topic_alias_count(CC_Mqtt5ClientHandle handle)</div><div class="ttdoc">Get amount of allocated topic aliases.</div></div>
</div><!-- fragment --><p>To check whether a topic alias is allocated for specific topic use the <b><a class="el" href="group__client.html#ga495bd1b9620e47add27eaef2d707cce8" title="Check if topic alias is allocated for topic.">cc_mqtt5_client_pub_topic_alias_is_allocated()</a></b> function. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> allocated = <a class="code" href="group__client.html#ga495bd1b9620e47add27eaef2d707cce8">cc_mqtt5_client_pub_topic_alias_is_allocated</a>(client, <span class="stringliteral">&quot;some_topic&quot;</span>);</div>
<div class="ttc" id="agroup__client_html_ga495bd1b9620e47add27eaef2d707cce8"><div class="ttname"><a href="group__client.html#ga495bd1b9620e47add27eaef2d707cce8">cc_mqtt5_client_pub_topic_alias_is_allocated</a></div><div class="ttdeci">bool cc_mqtt5_client_pub_topic_alias_is_allocated(CC_Mqtt5ClientHandle handle, const char *topic)</div><div class="ttdoc">Check if topic alias is allocated for topic.</div></div>
</div><!-- fragment --><p>Once the topic alias is successfully allocated, the <a class="el" href="index.html#cc_mqtt5_client_publish_basic">basic</a> configuration of the "publish" operation allows control of whether and how to use topic alias via the <a class="el" href="structCC__Mqtt5PublishBasicConfig.html#a20d153b8f30cac7030bf88a0d978bc2b">CC_Mqtt5PublishBasicConfig::m_topicAliasPref</a> data member.</p>
<ul>
<li><a class="el" href="group__publish.html#gga3f6ff6abe155494dc72eff08c90af002a1c9ece499481ece8d7a46c54e4f1e9ba">CC_Mqtt5TopicAliasPreference_UseAliasIfAvailable</a> - Default value, allows usage of the topic alias if such is available and it's up to the library to choose whether to send topic alias alone or in conjunction with the topic string itself. </li>
<li><a class="el" href="group__publish.html#gga3f6ff6abe155494dc72eff08c90af002a239d318694194603c075a8f722ebd0b7">CC_Mqtt5TopicAliasPreference_ForceAliasOnly</a> - Forces sending only the topic alias without the topic string. </li>
<li><a class="el" href="group__publish.html#gga3f6ff6abe155494dc72eff08c90af002a7d36e469ab78e6c09e769df53d5ccbb5">CC_Mqtt5TopicAliasPreference_ForceTopicOnly</a> - Forces sending only the topic string without the topic alias even if such was allocated (registered). </li>
<li><a class="el" href="group__publish.html#gga3f6ff6abe155494dc72eff08c90af002a583df4fa8625cec3124151454becf63f">CC_Mqtt5TopicAliasPreference_ForceTopicWithAlias</a> - Forces sending both topic alias and topic string even if it is safe to send topic alias only.</li>
</ul>
<h1><a class="anchor" id="cc_mqtt5_client_receive"></a>
Receiving Messages</h1>
<p>Right after the successful "connect" operation, the library starts expecting the arrival of the new messages and reports it via the <a class="el" href="index.html#cc_mqtt5_client_callbacks_message">registered callback</a>. <b>By default</b> the library monitors the topics the client application <a class="el" href="index.html#cc_mqtt5_client_subscribe">subscribed</a> to and does not report "rogue" messages from the broker.</p>
<p><b>Note</b> that only topics themselves are monitored, and not the requested maximal <b>QoS</b> values. It means that if application requested maximal <b>QoS1</b> for a particular subscription, but the broker sends message using the <b>QoS2</b>, the message is still going to be reported to the application.</p>
<p>However, if the broker is trusted to do the right thing, i.e. fully comply to the specification, it is possible to enable / disable the incoming topics check using the <b><a class="el" href="group__client.html#gacf0774f6cefca51be7f4dcf6e3abe9dc" title="Control verification of the incoming message being correctly subscribed.">cc_mqtt5_client_set_verify_incoming_msg_subscribed()</a></b> for performance reasons. </p><div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__client.html#gacf0774f6cefca51be7f4dcf6e3abe9dc">cc_mqtt5_client_set_verify_incoming_msg_subscribed</a>(client, <span class="keyword">false</span>);</div>
<div class="ttc" id="agroup__client_html_gacf0774f6cefca51be7f4dcf6e3abe9dc"><div class="ttname"><a href="group__client.html#gacf0774f6cefca51be7f4dcf6e3abe9dc">cc_mqtt5_client_set_verify_incoming_msg_subscribed</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_set_verify_incoming_msg_subscribed(CC_Mqtt5ClientHandle handle, bool enabled)</div><div class="ttdoc">Control verification of the incoming message being correctly subscribed.</div></div>
</div><!-- fragment --><p> To retrieve the current configuration use the <b><a class="el" href="group__client.html#ga5a5c02ab32290a088386d3a4fb166f67" title="Retrieve current incoming message being correctly subscribed control.">cc_mqtt5_client_get_verify_incoming_msg_subscribed()</a></b> function.</p>
<p>Similarly, the library also <b>by default</b> verifies the incoming topic format, that it doesn't contain wildcard characters. To enable / disable such verification use the <b><a class="el" href="group__client.html#ga5f0409574dbcd44ba61f026af134c19c" title="Control incoming topic format verification.">cc_mqtt5_client_set_verify_incoming_topic_enabled()</a></b> function. </p><div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__client.html#ga5f0409574dbcd44ba61f026af134c19c">cc_mqtt5_client_set_verify_incoming_topic_enabled</a>(client, <span class="keyword">false</span>);</div>
<div class="ttc" id="agroup__client_html_ga5f0409574dbcd44ba61f026af134c19c"><div class="ttname"><a href="group__client.html#ga5f0409574dbcd44ba61f026af134c19c">cc_mqtt5_client_set_verify_incoming_topic_enabled</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_set_verify_incoming_topic_enabled(CC_Mqtt5ClientHandle handle, bool enabled)</div><div class="ttdoc">Control incoming topic format verification.</div></div>
</div><!-- fragment --><p> To retrieve the current configuration use the <b><a class="el" href="group__client.html#ga45c0068cf16db408d38601a74168da1e" title="Retrieve current incoming topic format verification control.">cc_mqtt5_client_get_verify_incoming_topic_enabled()</a></b> function.</p>
<p>The <b>QoS2</b> publish operation initiated by the broker requires exchange of multiple messages between the broker and the client. When the library responds with the <b>PUBREC</b> message, the broker is expected to send <b>PUBREL</b> back. The library uses the <a class="el" href="index.html#cc_mqtt5_client_response_timeout">Default Response Timeout</a> configuration to measure the time frame during which it allows the reception of the corresponding <b>PUBREL</b> message. If the latter doesn't arrive in time, the whole <b>PUBLISH</b> request gets discarded and not reported to the application.</p>
<h1><a class="anchor" id="cc_mqtt5_client_reauth"></a>
Re-Authenticating</h1>
<p>The MQTT5 specification allows performing re-authentication after the successful <a class="el" href="index.html#cc_mqtt5_client_connect">"connect"</a> operation using the same authentication method. To do so use the <a class="el" href="group__reauth.html">reauth</a> operation.</p>
<h2><a class="anchor" id="cc_mqtt5_client_reauth_prepare"></a>
Preparing "Rauth" Operation.</h2>
<div class="fragment"><div class="line"><a class="code" href="group__global.html#gac9c64dc7d5a785e8b22d7faaaf6f9bea">CC_Mqtt5ErrorCode</a> ec = <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>;</div>
<div class="line"><a class="code" href="group__reauth.html#ga08a25f014815be006a28a6729b1983b2">CC_Mqtt5ReauthHandle</a> reauth = <a class="code" href="group__reauth.html#gaa5a8c695cd0963130334b89dd8a8c87a">cc_mqtt5_client_reauth_prepare</a>(client, &amp;ec);</div>
<div class="line"><span class="keywordflow">if</span> (reauth == NULL) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Reauth allocation failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__reauth_html_ga08a25f014815be006a28a6729b1983b2"><div class="ttname"><a href="group__reauth.html#ga08a25f014815be006a28a6729b1983b2">CC_Mqtt5ReauthHandle</a></div><div class="ttdeci">CC_Mqtt5Reauth * CC_Mqtt5ReauthHandle</div><div class="ttdoc">Handle for &quot;reauth&quot; operation.</div><div class="ttdef"><b>Definition:</b> common.h:246</div></div>
<div class="ttc" id="agroup__reauth_html_gaa5a8c695cd0963130334b89dd8a8c87a"><div class="ttname"><a href="group__reauth.html#gaa5a8c695cd0963130334b89dd8a8c87a">cc_mqtt5_client_reauth_prepare</a></div><div class="ttdeci">CC_Mqtt5ReauthHandle cc_mqtt5_client_reauth_prepare(CC_Mqtt5ClientHandle handle, CC_Mqtt5ErrorCode *ec)</div><div class="ttdoc">Prepare &quot;reauth&quot; operation.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="cc_mqtt5_client_reauth_response_timeout"></a>
Configuring "Reauth" Response Timeout</h2>
<p>When created, the "reauth" operation inherits the <a class="el" href="index.html#cc_mqtt5_client_response_timeout">Default Response Timeout</a> configuration. It can be changed for the allocated operation using the <b><a class="el" href="group__reauth.html#gabb6c81659a1b8ba4bd8962452dafddad" title="Configure the broker response timeout for the &quot;reauth&quot; operation.">cc_mqtt5_client_reauth_set_response_timeout()</a></b> function. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__reauth.html#gabb6c81659a1b8ba4bd8962452dafddad">cc_mqtt5_client_reauth_set_response_timeout</a>(reauth, 1000);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    ... <span class="comment">/* Something went wrong */</span></div>
<div class="line">}</div>
<div class="ttc" id="agroup__reauth_html_gabb6c81659a1b8ba4bd8962452dafddad"><div class="ttname"><a href="group__reauth.html#gabb6c81659a1b8ba4bd8962452dafddad">cc_mqtt5_client_reauth_set_response_timeout</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_reauth_set_response_timeout(CC_Mqtt5ReauthHandle handle, unsigned ms)</div><div class="ttdoc">Configure the broker response timeout for the &quot;reauth&quot; operation.</div></div>
</div><!-- fragment --><p> To retrieve the configured response timeout use the <b><a class="el" href="group__reauth.html#gadb9234ca939d08c080644c5883b799a9" title="Retrieve the configured the broker response timeout for the &quot;reauth&quot; operation.">cc_mqtt5_client_reauth_get_response_timeout()</a></b> function.</p>
<h2><a class="anchor" id="cc_mqtt5_client_reauth_auth"></a>
(Re)Authentication Handshake Configuration</h2>
<p>To configure the re-authentication handshake use the <b><a class="el" href="group__reauth.html#gaee6d78cdb2f37aa3c600c46510ec01bc" title="Perform authentication handshake configuration of the &quot;reauth&quot; operation.">cc_mqtt5_client_reauth_config_auth()</a></b> function. It is very similar to the <a class="el" href="index.html#cc_mqtt5_client_connect_auth">Extended Authentication Handshake Configuration</a> of the "connect" operation. </p><div class="fragment"><div class="line"><a class="code" href="group__global.html#gaa2b0e4ecc24bfd83703e722793a0bca1">CC_Mqtt5AuthErrorCode</a> my_auth_handshake_cb(<span class="keywordtype">void</span>* data, <span class="keyword">const</span> <a class="code" href="structCC__Mqtt5AuthInfo.html">CC_Mqtt5AuthInfo</a>* authInfoIn, <a class="code" href="structCC__Mqtt5AuthInfo.html">CC_Mqtt5AuthInfo</a>* authInfoOut)</div>
<div class="line">{</div>
<div class="line">    ... <span class="comment">// Analyse authInfoIn</span></div>
<div class="line">    <span class="keywordflow">if</span> (auth_failed) {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__global.html#ggaa2b0e4ecc24bfd83703e722793a0bca1adea033704c194c4d575eee5d7f6c111f">CC_Mqtt5AuthErrorCode_Disconnect</a>; <span class="comment">// terminate handshake with error</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    ... <span class="comment">// Populate authInfoOut</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__global.html#ggaa2b0e4ecc24bfd83703e722793a0bca1a73da94a53d477ad876e2a3133137fb30">CC_Mqtt5AuthErrorCode_Continue</a>; <span class="comment">// continue handshake</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="structCC__Mqtt5AuthConfig.html">CC_Mqtt5AuthConfig</a> authConfig;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the configuration structure to the default values</span></div>
<div class="line"><a class="code" href="group__reauth.html#gab85d168a8a25d7efed6690c9bd32abb4">cc_mqtt5_client_reauth_init_config_auth</a>(&amp;authConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assign all the necessary values</span></div>
<div class="line">authConfig.<a class="code" href="structCC__Mqtt5AuthConfig.html#abad1e68933d95a4bd391d3debe9e585e">m_authMethod</a> = <span class="stringliteral">&quot;some_method&quot;</span></div>
<div class="line">authConfig.<a class="code" href="structCC__Mqtt5AuthConfig.html#a689c2e51c3fd0a27105f8fde47e67e89">m_authData</a> = ...;</div>
<div class="line">authConfig.<a class="code" href="structCC__Mqtt5AuthConfig.html#a35b9e67dfc077f8b2731cbd234362851">m_authDataLen</a> = ...;</div>
<div class="line">authConfig.<a class="code" href="structCC__Mqtt5AuthConfig.html#a60dc71b1ead1becc3b61181fa0d965a4">m_authCb</a> = &amp;my_auth_handshake_cb;</div>
<div class="line">authConfig.<a class="code" href="structCC__Mqtt5AuthConfig.html#a25b1bc5f096cb8b588c5119e2e1d6e6c">m_authCbData</a> = ...;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the configuration</span></div>
<div class="line">ec = <a class="code" href="group__reauth.html#gaee6d78cdb2f37aa3c600c46510ec01bc">cc_mqtt5_client_reauth_config_auth</a>(reauth, &amp;authConfig);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Re-Authentication handshake configuration failed with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__reauth_html_gab85d168a8a25d7efed6690c9bd32abb4"><div class="ttname"><a href="group__reauth.html#gab85d168a8a25d7efed6690c9bd32abb4">cc_mqtt5_client_reauth_init_config_auth</a></div><div class="ttdeci">void cc_mqtt5_client_reauth_init_config_auth(CC_Mqtt5AuthConfig *config)</div><div class="ttdoc">Intialize the CC_Mqtt5AuthConfig configuration structure.</div></div>
<div class="ttc" id="agroup__reauth_html_gaee6d78cdb2f37aa3c600c46510ec01bc"><div class="ttname"><a href="group__reauth.html#gaee6d78cdb2f37aa3c600c46510ec01bc">cc_mqtt5_client_reauth_config_auth</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_reauth_config_auth(CC_Mqtt5ReauthHandle handle, const CC_Mqtt5AuthConfig *config)</div><div class="ttdoc">Perform authentication handshake configuration of the &quot;reauth&quot; operation.</div></div>
</div><!-- fragment --><p> During the "reauth" operation, both client and the broker exchange multiple <b>AUTH</b> messages. When such message arrive the library will invoke provided handshake callback. The responsibility of the callback is to analyze the incoming authentication data and populate the response information. The client can fail the handshake by returning the <a class="el" href="group__global.html#ggaa2b0e4ecc24bfd83703e722793a0bca1adea033704c194c4d575eee5d7f6c111f">CC_Mqtt5AuthErrorCode_Disconnect</a> instead of the <a class="el" href="group__global.html#ggaa2b0e4ecc24bfd83703e722793a0bca1a73da94a53d477ad876e2a3133137fb30">CC_Mqtt5AuthErrorCode_Continue</a>.</p>
<p>In case the application fails the re-authentication handshake by returning the <a class="el" href="group__global.html#ggaa2b0e4ecc24bfd83703e722793a0bca1adea033704c194c4d575eee5d7f6c111f">CC_Mqtt5AuthErrorCode_Disconnect</a> value library preforms the following steps: </p><ul>
<li>Sends <b>DISCONNECT</b> message to the broker. </li>
<li>Invokes the operation completion callback (see <a class="el" href="index.html#cc_mqtt5_client_reauth_send">Sending Re-Authentication Request</a> below) with the <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da805071d40ad1703c18988178c52804ff">CC_Mqtt5AsyncOpStatus_Aborted</a> as status value report. </li>
<li>Invokes the callbacks of all other incomplete operations with the the <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da805071d40ad1703c18988178c52804ff">CC_Mqtt5AsyncOpStatus_Aborted</a> as status value report. </li>
<li>Invokes the <a class="el" href="index.html#cc_mqtt5_client_callbacks_broker_disconnect">disconnection report callback</a> to report disconnection from the broker. See also <a class="el" href="index.html#cc_mqtt5_client_unsolicited_disconnect">Unsolicited Broker Disconnection</a> section below for details on how to proceed after the callback invocation.</li>
</ul>
<p><b>IMPORTANT:</b> The <b><a class="el" href="group__reauth.html#gaee6d78cdb2f37aa3c600c46510ec01bc" title="Perform authentication handshake configuration of the &quot;reauth&quot; operation.">cc_mqtt5_client_reauth_config_auth()</a></b> function mustn't be called more than once for a single "reauth" operation. Otherwise it may result in setting multiple properties of the same type, which is the "Protocol Error" according to the MQTT5 specification.</p>
<h2><a class="anchor" id="cc_mqtt5_client_reauth_send"></a>
Sending Re-Authentication Request</h2>
<p>When all the necessary configurations are performed for the allocated "reauth" operation it can actually be sent to the broker. To initiate sending use the <b><a class="el" href="group__reauth.html#ga0d0be616c870c39e8b6be117911dc92d" title="Send the configured &quot;reauth&quot; operation to broker.">cc_mqtt5_client_reauth_send()</a></b> function. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> my_reauth_complete_cb(<span class="keywordtype">void</span>* data, <a class="code" href="group__global.html#gabd56266bda747f19e4c6669fa0da021d">CC_Mqtt5AsyncOpStatus</a> status, <span class="keyword">const</span> <a class="code" href="structCC__Mqtt5AuthInfo.html">CC_Mqtt5AuthInfo</a>* response)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (status != <a class="code" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;ERROR: The connection operation has failed with status=%d\n&quot;</span>, status);</div>
<div class="line">        ... <span class="comment">// handle error.</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// &quot;response&quot; is not NULL when status is CC_Mqtt5AsyncOpStatus_Complete.</span></div>
<div class="line">    assert(response != NULL);</div>
<div class="line">    ... <span class="comment">// Analyze response values.</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">ec = <a class="code" href="group__reauth.html#ga0d0be616c870c39e8b6be117911dc92d">cc_mqtt5_client_reauth_send</a>(reauth, &amp;my_reauth_complete_cb, data);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to send reauth request with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__reauth_html_ga0d0be616c870c39e8b6be117911dc92d"><div class="ttname"><a href="group__reauth.html#ga0d0be616c870c39e8b6be117911dc92d">cc_mqtt5_client_reauth_send</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_reauth_send(CC_Mqtt5ReauthHandle handle, CC_Mqtt5ReauthCompleteCb cb, void *cbData)</div><div class="ttdoc">Send the configured &quot;reauth&quot; operation to broker.</div></div>
</div><!-- fragment --><p> The provided callback will be invoked when the "reauth" operation is complete <b> if and only if</b> the function returns <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>.</p>
<p>The handle returned by the <b><a class="el" href="group__reauth.html#gaa5a8c695cd0963130334b89dd8a8c87a" title="Prepare &quot;reauth&quot; operation.">cc_mqtt5_client_reauth_prepare()</a></b> function can be discarded (there is no free / de-allocation) right after the <b><a class="el" href="group__reauth.html#ga0d0be616c870c39e8b6be117911dc92d" title="Send the configured &quot;reauth&quot; operation to broker.">cc_mqtt5_client_reauth_send()</a></b> invocation regardless of the returned error code. However, the handle remains valid until the callback is called (in case the <a class="el" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a> was returned). The valid handle can be used to <a class="el" href="index.html#cc_mqtt5_client_reauth_cancel">cancel</a> the operation before the completion callback is invoked.</p>
<p>When the "reauth" operation completion callback is invoked the reported "response" information is present <b>if and only if</b> the "status" is <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da1612bd223303ddf181264c196d24855d">CC_Mqtt5AsyncOpStatus_Complete</a>.</p>
<p><b>NOTE</b> that only single "reauth" operation is allowed at a time, any attempt to prepare a new one via <b><a class="el" href="group__reauth.html#gaa5a8c695cd0963130334b89dd8a8c87a" title="Prepare &quot;reauth&quot; operation.">cc_mqtt5_client_reauth_prepare()</a></b> will be rejected until the "reauth" operation completion callback is invoked or the operation is <a class="el" href="index.html#cc_mqtt5_client_reauth_cancel">cancelled</a>.</p>
<h2><a class="anchor" id="cc_mqtt5_client_reauth_cancel"></a>
Cancel the "Reauth" Operation.</h2>
<p>While the handle returned by the <b><a class="el" href="group__reauth.html#gaa5a8c695cd0963130334b89dd8a8c87a" title="Prepare &quot;reauth&quot; operation.">cc_mqtt5_client_reauth_prepare()</a></b> is still valid it is possible to cancel / discard the operation. </p><div class="fragment"><div class="line">ec = <a class="code" href="group__reauth.html#ga9956e7644c5b3efdb601099c1ec404ba">cc_mqtt5_client_reauth_cancel</a>(reauth);</div>
<div class="line"><span class="keywordflow">if</span> (ec != <a class="code" href="group__global.html#ggac9c64dc7d5a785e8b22d7faaaf6f9beaa8f6454b1f4f259f82322e3b5517a4d63">CC_Mqtt5ErrorCode_Success</a>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;ERROR: Failed to cancel reauth with ec=%d\n&quot;</span>, ec);</div>
<div class="line">    ...</div>
<div class="line">}</div>
<div class="ttc" id="agroup__reauth_html_ga9956e7644c5b3efdb601099c1ec404ba"><div class="ttname"><a href="group__reauth.html#ga9956e7644c5b3efdb601099c1ec404ba">cc_mqtt5_client_reauth_cancel</a></div><div class="ttdeci">CC_Mqtt5ErrorCode cc_mqtt5_client_reauth_cancel(CC_Mqtt5ReauthHandle handle)</div><div class="ttdoc">Cancel the allocated &quot;reauth&quot; operation.</div></div>
</div><!-- fragment --><p> In case the <b><a class="el" href="group__reauth.html#ga0d0be616c870c39e8b6be117911dc92d" title="Send the configured &quot;reauth&quot; operation to broker.">cc_mqtt5_client_reauth_send()</a></b> function was successfully called before the <b><a class="el" href="group__reauth.html#ga9956e7644c5b3efdb601099c1ec404ba" title="Cancel the allocated &quot;reauth&quot; operation.">cc_mqtt5_client_reauth_cancel()</a></b>, the operation is cancelled <b>without</b> callback invocation.</p>
<p>In case the re-authentication is rejected by the broker, the latter is expected to send the <b>DISCONNECT</b> message resulting in the <a class="el" href="index.html#cc_mqtt5_client_unsolicited_disconnect">Unsolicited Broker Disconnection</a>. In such case the completion callback will be invoked with the <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da0f187c57434fb51740a8ecb4f8e97400">CC_Mqtt5AsyncOpStatus_BrokerDisconnected</a> status.</p>
<h1><a class="anchor" id="cc_mqtt5_client_unsolicited_disconnect"></a>
Unsolicited Broker Disconnection</h1>
<p>The unsolicited broker disconnection can happen in one of the following cases.</p>
<h2><a class="anchor" id="cc_mqtt5_client_unsolicited_disconnect_msg"></a>
Receiving DISCONNECT message</h2>
<p>The broker can initiate disconnection any time by simply sending <b>DISCONNECT</b> message. In such case the library responds in the following way: </p><ul>
<li>Terminates and invokes the callbacks of previously initiated but incomplete operations passing the <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da0f187c57434fb51740a8ecb4f8e97400">CC_Mqtt5AsyncOpStatus_BrokerDisconnected</a> as their status report. </li>
<li>Invokes the <a class="el" href="index.html#cc_mqtt5_client_callbacks_broker_disconnect">disconnection report callback</a> registered using the <b><a class="el" href="client_8h.html#a69eb3593894b142f5f4b4e044e04d527" title="Set callback to report unsolicited disconnection of the broker.">cc_mqtt5_client_set_broker_disconnect_report_callback()</a></b> function. The information passed in the <b>DISCONNECT</b> message is used to populate reported disconnection information.</li>
</ul>
<h2><a class="anchor" id="cc_mqtt5_client_unsolicited_disconnect_protocol_error"></a>
Detecting Protocol Error</h2>
<p>In case the broker doesn't fully comply with the MQTT5 specification or there is some unexpected data corruption the library responds in the following way: </p><ul>
<li>Sends <b>DISCONNECT</b> message to the broker reporting error. </li>
<li>Terminates and invokes the callback of the operation that detected the protocol error with the <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da071eb43b2ab5499d3bd753f083de10a7">CC_Mqtt5AsyncOpStatus_ProtocolError</a> status report. </li>
<li>Terminates and invokes the callbacks of all other previously initiated but incomplete operations passing the <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da0f187c57434fb51740a8ecb4f8e97400">CC_Mqtt5AsyncOpStatus_BrokerDisconnected</a> as their status report. </li>
<li>Invokes the <a class="el" href="index.html#cc_mqtt5_client_callbacks_broker_disconnect">disconnection report callback</a> registered using the <b><a class="el" href="client_8h.html#a69eb3593894b142f5f4b4e044e04d527" title="Set callback to report unsolicited disconnection of the broker.">cc_mqtt5_client_set_broker_disconnect_report_callback()</a></b> function without any disconnection information.</li>
</ul>
<p>With all said above it means that if application receives <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da071eb43b2ab5499d3bd753f083de10a7">CC_Mqtt5AsyncOpStatus_ProtocolError</a> or <a class="el" href="group__global.html#ggabd56266bda747f19e4c6669fa0da021da0f187c57434fb51740a8ecb4f8e97400">CC_Mqtt5AsyncOpStatus_BrokerDisconnected</a> status in one of its callback, then the application is expected to wait for the <a class="el" href="index.html#cc_mqtt5_client_callbacks_broker_disconnect">disconnection report callback</a> which will follow.</p>
<p>When the <a class="el" href="index.html#cc_mqtt5_client_callbacks_broker_disconnect">disconnection report callback</a> is called the application is expected to go through the following steps: </p><ul>
<li>Close network connection. </li>
<li>Re-establish network connection to the broker. </li>
<li>Go through the <a class="el" href="index.html#cc_mqtt5_client_init">re-initialization</a> process. Make sure to do it in the next iteration of the event loop and not from within the disconnection report callback. </li>
<li>Perform the <a class="el" href="index.html#cc_mqtt5_client_connect">"connect"</a> operation.</li>
</ul>
<h1><a class="anchor" id="cc_mqtt5_client_network_disconnect"></a>
Network Disconnection</h1>
<p>The MQTT5 specification also tries to support intermittent network connection by setting the "Session Expiry Interval" property during the <a class="el" href="index.html#cc_mqtt5_client_connect">"connect"</a> operation (see <a class="el" href="structCC__Mqtt5ConnectExtraConfig.html#af473dd3f19fd748259f35297e4e75fb1">CC_Mqtt5ConnectExtraConfig::m_sessionExpiryInterval</a>). Such network disconnection is usually detected by the failing <b>read</b> or <b>write</b> operations on I/O socket. When the application detects such network disconnection, it is expected to report it to the library using <b><a class="el" href="group__client.html#ga726e9de1b87f3bdb3c86679f48b22569" title="Report network disconnected status.">cc_mqtt5_client_notify_network_disconnected()</a></b> function. </p><div class="fragment"><div class="line"><span class="comment">// Report network disconnected</span></div>
<div class="line"><a class="code" href="group__client.html#ga726e9de1b87f3bdb3c86679f48b22569">cc_mqtt5_client_notify_network_disconnected</a>(client, <span class="keyword">true</span>);</div>
<div class="ttc" id="agroup__client_html_ga726e9de1b87f3bdb3c86679f48b22569"><div class="ttname"><a href="group__client.html#ga726e9de1b87f3bdb3c86679f48b22569">cc_mqtt5_client_notify_network_disconnected</a></div><div class="ttdeci">void cc_mqtt5_client_notify_network_disconnected(CC_Mqtt5ClientHandle handle, bool disconnected)</div><div class="ttdoc">Report network disconnected status.</div></div>
</div><!-- fragment --><p> When network disconnection is reported some internal timers such as waiting for QoS1/QoS2 publish responses get suspended for the period of configured "Session Expiry Interval".</p>
<p>If the application manages to re-establish connection by repeating failing <b>read</b> / <b>write</b> operations for several times until they succeed, then the application is expected to report the network re-connection by invoking the same <b><a class="el" href="group__client.html#ga726e9de1b87f3bdb3c86679f48b22569" title="Report network disconnected status.">cc_mqtt5_client_notify_network_disconnected()</a></b> function. </p><div class="fragment"><div class="line"><span class="comment">// Report network reconnected</span></div>
<div class="line"><a class="code" href="group__client.html#ga726e9de1b87f3bdb3c86679f48b22569">cc_mqtt5_client_notify_network_disconnected</a>(client, <span class="keyword">false</span>);</div>
</div><!-- fragment --><p> After such network re-connection is reported, the library will resume its timers and continue functioning as usual (as if network disconnection hasn't happened).</p>
<p>However, if the network re-connection is not reported until the "Session Expiry Interval" is over, then the library will proceed to the <a class="el" href="index.html#cc_mqtt5_client_unsolicited_disconnect">Unsolicited Broker Disconnection</a> logic.</p>
<p><b>Note</b> that if the "Session Expiry Interval" was not configured during the <a class="el" href="index.html#cc_mqtt5_client_connect">"connect"</a> operation, invocation of the <b><a class="el" href="group__client.html#ga726e9de1b87f3bdb3c86679f48b22569" title="Report network disconnected status.">cc_mqtt5_client_notify_network_disconnected()</a></b> will result in the <a class="el" href="index.html#cc_mqtt5_client_unsolicited_disconnect">Unsolicited Broker Disconnection</a> report right away.</p>
<p>Inquiry about current network disconnection status can be done using the <b><a class="el" href="group__client.html#ga80f86aebc763629d3994b6445dd2042c" title="Check current network disconnected status.">cc_mqtt5_client_is_network_disconnected()</a></b> function. </p><div class="fragment"><div class="line"><span class="keywordtype">bool</span> disconnected = <a class="code" href="group__client.html#ga80f86aebc763629d3994b6445dd2042c">cc_mqtt5_client_is_network_disconnected</a>(client);</div>
<div class="ttc" id="agroup__client_html_ga80f86aebc763629d3994b6445dd2042c"><div class="ttname"><a href="group__client.html#ga80f86aebc763629d3994b6445dd2042c">cc_mqtt5_client_is_network_disconnected</a></div><div class="ttdeci">bool cc_mqtt5_client_is_network_disconnected(CC_Mqtt5ClientHandle handle)</div><div class="ttdoc">Check current network disconnected status.</div></div>
</div><!-- fragment --><p>Also <b>note</b> that invocation of the <b><a class="el" href="group__client.html#gae16f1dae966b8bb63ba38e10bd35df38" title="(Re)Initialize client.">cc_mqtt5_client_init()</a></b> function (see <a class="el" href="index.html#cc_mqtt5_client_init">Client (Re)Initialization</a>) will result in library "assuming" network is connected, i.e. invocation of the <b><a class="el" href="group__client.html#ga80f86aebc763629d3994b6445dd2042c" title="Check current network disconnected status.">cc_mqtt5_client_is_network_disconnected()</a></b> will return <b>false</b>.</p>
<h1><a class="anchor" id="cc_mqtt5_client_thread_safety"></a>
Thread Safety</h1>
<p>In general the library is <b>NOT</b> thread safe. However, if each thread operates on a separate allocated <a class="el" href="index.html#cc_mqtt5_client_allocation">client</a>, then the locking is required only for the <a class="el" href="index.html#cc_mqtt5_client_allocation">client allocation logic</a>.</p>
<p>If multiple threads work with the same <a class="el" href="index.html#cc_mqtt5_client_allocation">client</a> object (such as performing "publish" operations, or handling incoming messages in parallel), then explicit locking logic needs to be implemented by the application itself.</p>
<h1><a class="anchor" id="cc_mqtt5_client_debug_build"></a>
Debug Build</h1>
<p>The client library uses <a href="https://commschamp.github.io/comms_doc/page_use_prot.html#page_use_prot_error_handling">COMMS_ASSERT()</a> macro to check some internal pre- and post-conditions. It is a bug if the assertion fails, please report if encountered. By default it is like standard <a href="https://en.cppreference.com/w/cpp/error/assert">assert()</a> but allows overriding the default failure behavour, which can be more suitable for bare-metal systems. Please refer to the <a href="https://commschamp.github.io/comms_doc/page_assert.html">documentation</a> for details. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
